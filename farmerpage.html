<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Dashboard - FarmTrails</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script type="text/javascript">
    // Load Microsoft Clarity analytics only if configured
    if (window.CONFIG && window.CONFIG.CLARITY_PROJECT_ID) {
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", window.CONFIG.CLARITY_PROJECT_ID);
    }
    </script>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --light: #F1F8E9;
            --dark: #1B5E20;
            --text: #212121;
            --accent: #8BC34A;
            --white: #ffffff;
            --gray-light: #f5f5f5;
            --gray: #757575;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gray-light);
            color: var(--text);
            line-height: 1.6;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--primary), var(--accent));
            color: var(--white);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .desktop-nav {
            display: flex;
            gap: 10px;
        }
        
        .desktop-nav-item {
            color: var(--white);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: var(--radius);
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .desktop-nav-item:hover, .desktop-nav-item.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--white);
            color: var(--white);
        }
        
        .btn-outline:hover {
            background: var(--white);
            color: var(--primary);
        }
        
        .btn-primary {
            background: var(--secondary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: #F57C00;
        }
        
        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            font-size: 0.7rem;
            transition: color 0.3s;
            flex: 1;
        }
        
        .mobile-nav-item.active {
            color: var(--primary);
        }
        
        .mobile-nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--dark);
            color: var(--white);
            padding: 1.5rem 1rem;
        }
        
        .farmer-info {
            text-align: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
        }
        
        .farmer-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1rem;
            border: 3px solid var(--accent);
        }
        
        .farmer-info h3 {
            margin-bottom: 0.5rem;
        }
        
        .farmer-rating {
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            color: var(--white);
            text-decoration: none;
            border-radius: var(--radius);
            transition: background 0.3s;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-menu i {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 1.5rem;
            background: var(--gray-light);
            padding-bottom: 70px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .welcome-message h2 {
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        
        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-card i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .stat-card h3 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .stat-card p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Dashboard Section */
        .dashboard-section {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .section-header h3 {
            color: var(--dark);
        }
        
        /* Table Styles */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .table th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }
        
        .table tr:hover {
            background: #f9f9f9;
        }
        
        /* Status Badges */
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-pending {
            background: #FFF3CD;
            color: #856404;
        }
        
        .status-confirmed {
            background: #D4EDDA;
            color: #155724;
        }
        
        .status-shipped {
            background: #CCE5FF;
            color: #004085;
        }
        
        .status-delivered {
            background: #D4EDDA;
            color: #155724;
        }
        
        .status-cancelled {
            background: #F8D7DA;
            color: #721C24;
        }
        
        /* Product Cards */
        .product-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 1rem;
        }
        
        .product-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: transform 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-image {
            height: 180px;
            width: 100%;
            object-fit: cover;
        }
        
        .product-content {
            padding: 1.5rem;
        }
        
        .product-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .product-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .product-stock {
            color: var(--gray);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .btn-edit {
            background: #17A2B8;
            color: white;
        }
        
        .btn-edit:hover {
            background: #138496;
        }
        
        .btn-ship {
            background: #2196F3;
            color: white;
        }
        
        .btn-ship:hover {
            background: #0b7dda;
        }
        
        .btn-view {
            background: var(--primary);
            color: white;
        }
        
        .btn-view:hover {
            background: #3d8b40;
        }
        
        .btn-download {
            background: #6c757d;
            color: white;
        }
        
        .btn-download:hover {
            background: #5a6268;
        }
        
        .btn-delete {
            background: #DC3545;
            color: white;
        }
        
        .btn-delete:hover {
            background: #c82333;
        }
        
        /* Fulfillment Center Styles */
        .fulfillment-notice {
            background: #E3F2FD;
            border-left: 4px solid #2196F3;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .fulfillment-notice h4 {
            color: #0D47A1;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .fulfillment-notice p {
            color: #1565C0;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .shipping-instructions {
            background: #E8F5E8;
            border: 1px solid #4CAF50;
            border-radius: var(--radius);
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .shipping-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .shipping-address {
            background: var(--light);
            padding: 1rem;
            border-radius: var(--radius);
        }
        
        .shipment-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-not-sent {
            background: #FFECB3;
            color: #7D6608;
        }
        
        .status-pending {
            background: #FFF3CD;
            color: #856404;
        }
        
        .status-in-transit {
            background: #CCE5FF;
            color: #004085;
        }
        
        .status-received {
            background: #D4EDDA;
            color: #155724;
        }
        
        .fulfillment-section {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .fulfillment-status {
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--dark);
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Image Upload */
        .image-upload-container {
            border: 2px dashed #ddd;
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }
        
        .image-upload-container:hover {
            border-color: var(--primary);
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 0 auto 1rem;
            display: none;
        }
        
        .image-preview img {
            width: 100%;
            height: auto;
            border-radius: var(--radius);
        }
        
        .upload-btn {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            margin: 10px 0;
        }
        
        /* Shipping Options */
        .shipping-options {
            display: flex;
            gap: 10px;
            margin: 1rem 0;
        }
        
        .shipping-option {
            flex: 1;
            text-align: center;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .shipping-option:hover {
            border-color: var(--primary);
        }
        
        .shipping-option.selected {
            border-color: var(--primary);
            background: var(--light);
        }
        
        /* Label and Invoice Preview */
        .preview-container {
            border: 1px solid #ddd;
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1rem;
            background: white;
        }
        
        .label-preview, .invoice-preview {
            text-align: center;
        }
        
        .qr-code {
            margin: 1rem auto;
            width: 150px;
            height: 150px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .invoice-table th, .invoice-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .invoice-table th {
            background: var(--light);
        }
        
        .invoice-total {
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 1rem;
            text-align: right;
        }
        
        /* Tours Section */
        .tour-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 1rem;
        }
        
        .tour-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: transform 0.3s;
        }
        
        .tour-card:hover {
            transform: translateY(-5px);
        }
        
        .tour-image {
            height: 180px;
            width: 100%;
            object-fit: cover;
        }
        
        .tour-content {
            padding: 1.5rem;
        }
        
        .tour-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .tour-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .tour-description {
            margin-bottom: 1.5rem;
            color: var(--text);
        }
        
        .tour-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        /* Profile Section */
        .profile-section {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 2rem;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--accent);
        }
        
        .profile-info h2 {
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        
        .profile-info p {
            color: var(--gray);
            margin-bottom: 0.5rem;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 1.5rem;
        }
        
        .profile-stat {
            text-align: center;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius);
        }
        
        .profile-stat h3 {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        
        .profile-stat p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .profile-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .detail-group {
            margin-bottom: 1.5rem;
        }
        
        .detail-group h4 {
            color: var(--dark);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .detail-label {
            font-weight: 500;
            color: var(--gray);
        }
        
        .detail-value {
            color: var(--text);
        }
        
        /* Analytics Section */
        .analytics-section {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 1rem;
        }
        
        .chart-container {
            background: var(--light);
            border-radius: var(--radius);
            padding: 1rem;
            height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .chart-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--gray);
            text-align: center;
        }
        
        /* Add Product Form */
        .add-form {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .add-form h3 {
            margin-bottom: 1.5rem;
            color: var(--dark);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                display: none;
            }
            
            .sidebar.mobile-open {
                display: block;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .desktop-nav {
                display: none;
            }
            
            .header-right.mobile-open .desktop-nav {
                display: flex;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--primary);
                padding: 1rem;
                box-shadow: var(--shadow);
            }
            
            .product-actions {
                flex-direction: column;
            }
            
            .shipping-options {
                flex-direction: column;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .mobile-nav {
                display: flex;
            }
            
            .profile-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease-in-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification i {
            font-size: 1.2rem;
        }
        
        /* Page Content */
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* Hidden elements for PDF generation */
        .pdf-template {
            position: absolute;
            left: -9999px;
            top: -9999px;
            width: 210mm;
            padding: 20px;
            background: white;
            box-sizing: border-box;
        }
        
        /* Bookings Styles */
        .bookings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .bookings-table th, .bookings-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .bookings-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }
        
        .bookings-table tr:hover {
            background: #f9f9f9;
        }
        
        .booking-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-confirmed {
            background: #D4EDDA;
            color: #155724;
        }
        
        .status-pending {
            background: #FFF3CD;
            color: #856404;
        }
        
        .status-cancelled {
            background: #F8D7DA;
            color: #721C24;
        }
        
        .status-completed {
            background: #CCE5FF;
            color: #004085;
        }
        
        /* Empty State Styles */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin: 2rem 0;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: var(--gray-light);
            margin-bottom: 1.5rem;
        }
        
        .empty-state h3 {
            color: var(--dark);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .empty-state p {
            color: var(--gray);
            margin-bottom: 2rem;
            font-size: 1rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .empty-state .btn {
            margin: 0.5rem;
        }
        
        .no-bookings {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }
        
        .bookings-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            background: white;
        }
        
        .bookings-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 1.5rem;
        }
        
        .summary-card {
            background: var(--white);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .summary-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .summary-card p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }
        
        .loading i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .welcome-new-farmer {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 2rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .welcome-new-farmer h2 {
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }
        
        .welcome-new-farmer p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .quick-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .quick-actions .btn {
            padding: 12px 24px;
            font-size: 1rem;
        }
        
        .read-only-field {
            background-color: #f5f5f5;
            color: #666;
            cursor: not-allowed;
        }
        
        .non-editable {
            opacity: 0.7;
        }
        
        .non-editable .detail-label {
            color: #999;
        }
        
        .non-editable .detail-value {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h1>FarmTrails</h1>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="header-right" id="headerRight">
                <!-- Desktop Navigation -->
                <nav class="desktop-nav">
                    <a href="#" class="desktop-nav-item active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="desktop-nav-item" data-page="products">
                        <i class="fas fa-seedling"></i>
                        <span>Products</span>
                    </a>
                    <a href="#" class="desktop-nav-item" data-page="tours">
                        <i class="fas fa-map-marked-alt"></i>
                        <span>Tours</span>
                    </a>
                    <a href="#" class="desktop-nav-item" data-page="analytics">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </a>
                    <a href="#" class="desktop-nav-item" data-page="profile">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                </nav>
                
                <div class="profile">
                    <button class="btn btn-outline">Logout</button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Dashboard -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="farmer-info">
                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80" alt="Farmer" class="farmer-avatar">
                <h3>Rajesh Kumar</h3>
                <p>Organic Vegetable Farm</p>
                <div class="farmer-rating">
                    <i class="fas fa-star"></i> 4.8 Rating
                </div>
            </div>
            
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" data-page="products"><i class="fas fa-seedling"></i> Products</a></li>
                <li><a href="#" data-page="tours"><i class="fas fa-map-marked-alt"></i> Tours</a></li>
                <li><a href="#" data-page="analytics"><i class="fas fa-chart-line"></i> Analytics</a></li>
                <li><a href="#" data-page="profile"><i class="fas fa-user"></i> Profile</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
                <li><a href="#"><i class="fas fa-question-circle"></i> Help & Support</a></li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <div class="page-content active" id="dashboard-page">
                <div class="dashboard-header">
                    <div class="welcome-message">
                        <h2>Welcome, Rajesh!</h2>
                        <p>Here's what's happening with your farm today.</p>
                    </div>
                    <button class="btn btn-primary" id="addProductBtn">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>
                
                <!-- New Farmer Welcome Section (shown when no products/tours) -->
                <div class="welcome-new-farmer" id="newFarmerWelcome" style="display: none;">
                    <h2>Welcome to FarmTrails! ðŸŽ‰</h2>
                    <p>Get started by adding your first product or farm tour to showcase your farm to customers.</p>
                    <div class="quick-actions">
                        <button class="btn btn-outline" onclick="showPage('products-page')">
                            <i class="fas fa-seedling"></i> Add Your First Product
                        </button>
                        <button class="btn btn-outline" onclick="showPage('tours-page')">
                            <i class="fas fa-map-marked-alt"></i> Create Your First Tour
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <i class="fas fa-calendar-check"></i>
                        <h3 id="upcomingBookings">0</h3>
                        <p>Upcoming Bookings</p>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-rupee-sign"></i>
                        <h3 id="monthlyRevenue">â‚¹0</h3>
                        <p>Revenue This Month</p>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-seedling"></i>
                        <h3 id="productsCount">0</h3>
                        <p>Products Listed</p>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <h3 id="averageRating">4.8</h3>
                        <p>Average Rating</p>
                    </div>
                </div>
                
                <!-- Fulfillment Status Summary -->
                <div class="dashboard-section" id="fulfillmentSection">
                    <div class="section-header">
                        <h3><i class="fas fa-shipping-fast"></i> Fulfillment Center Status</h3>
                        <a href="#" onclick="showPage('products-page')">Manage Products</a>
                    </div>
                    <div class="stats-cards">
                        <div class="stat-card">
                            <i class="fas fa-box"></i>
                            <h3 id="productsAtCenter">0</h3>
                            <p>Products at Center</p>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-truck"></i>
                            <h3 id="inTransit">0</h3>
                            <p>In Transit</p>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-clock"></i>
                            <h3 id="awaitingShipment">0</h3>
                            <p>Awaiting Shipment</p>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-check-circle"></i>
                            <h3 id="delivered">0</h3>
                            <p>Successfully Delivered</p>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Orders Section -->
                <div class="dashboard-section" id="recentOrdersSection">
                    <div class="section-header">
                        <h3>Recent Orders</h3>
                        <a href="#">View All</a>
                    </div>
                    
                    <div id="recentOrdersContent">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Product</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrders">
                                <!-- Orders will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Products Page -->
            <div class="page-content" id="products-page">
                <div class="dashboard-header">
                    <div class="welcome-message">
                        <h2>Your Products</h2>
                        <p>Manage your farm products and inventory</p>
                    </div>
                    <button class="btn btn-primary" id="addProductBtn2">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>
                
                <!-- Fulfillment Notice -->
                <div class="fulfillment-notice">
                    <h4><i class="fas fa-shipping-fast"></i> FarmTrails Fulfillment Center Requirement</h4>
                    <p>Note: After listing your product, you are required to ship it to the FarmTrails Fulfillment Center. This ensures quality control and timely delivery to customers.</p>
                </div>
                
                <!-- Add Product Form -->
                <div class="add-form" id="addProductForm">
                    <h3>Add New Product</h3>
                    
                    <!-- Fulfillment Information -->
                    <div class="shipping-instructions">
                        <h4><i class="fas fa-info-circle"></i> Shipping Requirement</h4>
                        <p>After listing your product, you are required to ship it to the FarmTrails Fulfillment Center within 3 business days. This ensures quality control and timely delivery to customers.</p>
                        <div class="shipping-info">
                            <div class="shipping-address">
                                <strong>FarmTrails Fulfillment Center</strong><br>
                                123 Agriculture Park,<br>
                                Food Processing Zone,<br>
                                Pune, Maharashtra 411045<br>
                                Contact: +91 1800-FARMTRAILS
                            </div>
                        </div>
                    </div>
                    
                    <form id="productForm">
                        <div class="form-group">
                            <label for="productName">Product Name</label>
                            <input type="text" id="productName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">Category</label>
                            <select id="productCategory" required>
                                <option value="">Select Category</option>
                                <option value="vegetables">Vegetables</option>
                                <option value="fruits">Fruits</option>
                                <option value="dairy">Dairy</option>
                                <option value="spices">Spices</option>
                                <option value="grains">Grains</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="productPrice">Price (â‚¹)</label>
                            <input type="number" id="productPrice" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productUnit">Unit</label>
                            <input type="text" id="productUnit" placeholder="kg, gm, piece, etc." required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productStock">Initial Stock Quantity</label>
                            <input type="number" id="productStock" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productWeight">Approx. Weight per unit (kg)</label>
                            <input type="number" id="productWeight" step="0.1" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Product Image</label>
                            <div class="image-upload-container" id="imageUploadContainer">
                                <div class="image-preview" id="imagePreview">
                                    <img id="previewImage" src="" alt="Preview">
                                </div>
                                <div class="upload-text" id="uploadText">
                                    <i class="fas fa-cloud-upload-alt fa-2x" style="color: #ddd; margin-bottom: 1rem;"></i>
                                    <p>Click to upload product image</p>
                                </div>
                                <input type="file" id="productImage" accept="image/*" style="display: none;">
                                <button type="button" class="upload-btn" onclick="document.getElementById('productImage').click()">
                                    Choose Image
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" id="cancelProductBtn">Cancel</button>
                            <button type="submit" class="btn btn-primary">Add Product</button>
                        </div>
                    </form>
                </div>
                
                <!-- Products Grid with Fulfillment Status -->
                <div class="product-cards" id="productsContainer">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading products...</p>
                    </div>
                </div>
                
                <!-- Empty State for Products -->
                <div class="empty-state" id="productsEmptyState" style="display: none;">
                    <i class="fas fa-seedling"></i>
                    <h3>No Products Yet</h3>
                    <p>Start showcasing your farm products to customers. Add your first product to begin selling on FarmTrails.</p>
                    <button class="btn btn-primary" onclick="document.getElementById('addProductForm').style.display = 'block'">
                        <i class="fas fa-plus"></i> Add Your First Product
                    </button>
                </div>
                
                <!-- Fulfillment Instructions Section -->
                <div class="fulfillment-section">
                    <div class="section-header">
                        <h3><i class="fas fa-shipping-fast"></i> Fulfillment Center Instructions</h3>
                    </div>
                    <div class="shipping-info">
                        <div class="shipping-address">
                            <h4>Shipping Address</h4>
                            <p>
                                <strong>FarmTrails Fulfillment Center</strong><br>
                                123 Agriculture Park,<br>
                                Food Processing Zone,<br>
                                Pune, Maharashtra 411045<br>
                                ðŸ“ž +91 1800-FARMTRAILS
                            </p>
                        </div>
                        <div class="shipping-instructions">
                            <h4>Shipping Guidelines</h4>
                            <ul>
                                <li>Ship within 3 business days of listing</li>
                                <li>Use proper packaging for agricultural products</li>
                                <li>Include the generated shipping label</li>
                                <li>Maintain cold chain for perishable items</li>
                                <li>Maximum weight per package: 25kg</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tours Page -->
            <div class="page-content" id="tours-page">
                <div class="dashboard-header">
                    <div class="welcome-message">
                        <h2>Farm Tours & Experiences</h2>
                        <p>Manage your farm tours and visitor experiences</p>
                    </div>
                    <button class="btn btn-primary" id="addTourBtn">
                        <i class="fas fa-plus"></i> Add Tour
                    </button>
                </div>
                
                <!-- Add Tour Form -->
                <div class="add-form" id="addTourForm">
                    <h3>Add New Farm Tour</h3>
                    
                    <form id="tourForm">
                        <div class="form-group">
                            <label for="tourName">Tour Name</label>
                            <input type="text" id="tourName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tourDescription">Description</label>
                            <textarea id="tourDescription" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="tourLocation">Farm Location/Area</label>
                            <input type="text" id="tourLocation" placeholder="Specific area of farm for the tour" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tourDuration">Duration (hours)</label>
                            <input type="number" id="tourDuration" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tourCapacity">Maximum Participants</label>
                            <input type="number" id="tourCapacity" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tourPrice">Price per person (â‚¹)</label>
                            <input type="number" id="tourPrice" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Tour Image</label>
                            <div class="image-upload-container" id="tourImageUploadContainer">
                                <div class="image-preview" id="tourImagePreview">
                                    <img id="tourPreviewImage" src="" alt="Preview">
                                </div>
                                <div class="upload-text" id="tourUploadText">
                                    <i class="fas fa-cloud-upload-alt fa-2x" style="color: #ddd; margin-bottom: 1rem;"></i>
                                    <p>Click to upload tour image</p>
                                </div>
                                <input type="file" id="tourImage" accept="image/*" style="display: none;">
                                <button type="button" class="upload-btn" onclick="document.getElementById('tourImage').click()">
                                    Choose Image
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" id="cancelTourBtn">Cancel</button>
                            <button type="submit" class="btn btn-primary">Add Tour</button>
                        </div>
                    </form>
                </div>
                
                <!-- Tours Grid -->
                <div class="tour-cards" id="toursContainer">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading tours...</p>
                    </div>
                </div>
                
                <!-- Empty State for Tours -->
                <div class="empty-state" id="toursEmptyState" style="display: none;">
                    <i class="fas fa-map-marked-alt"></i>
                    <h3>No Tours Yet</h3>
                    <p>Create engaging farm experiences for visitors. Add your first tour to attract customers and showcase your farm.</p>
                    <button class="btn btn-primary" onclick="document.getElementById('addTourForm').style.display = 'block'">
                        <i class="fas fa-plus"></i> Create Your First Tour
                    </button>
                </div>
            </div>
            
            <!-- Analytics Page -->
            <div class="page-content" id="analytics-page">
                <div class="dashboard-header">
                    <div class="welcome-message">
                        <h2>Performance Analytics</h2>
                        <p>Track your farm's performance and growth</p>
                    </div>
                    <button class="btn btn-primary">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                </div>
                
                <!-- Empty State for Analytics -->
                <div class="empty-state" id="analyticsEmptyState" style="display: none;">
                    <i class="fas fa-chart-line"></i>
                    <h3>No Data Available Yet</h3>
                    <p>Analytics will appear here once you start adding products, tours, and receiving orders from customers.</p>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="showPage('products-page')">
                            <i class="fas fa-seedling"></i> Add Products
                        </button>
                        <button class="btn btn-primary" onclick="showPage('tours-page')">
                            <i class="fas fa-map-marked-alt"></i> Add Tours
                        </button>
                    </div>
                </div>
                
                <!-- Analytics Section -->
                <div class="analytics-section" id="analyticsContent">
                    <div class="section-header">
                        <h3>Revenue & Sales Analytics</h3>
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="chart-container">
                            <div class="chart-placeholder">
                                <div style="text-align: center;">
                                    <i class="fas fa-chart-line fa-3x" style="color: var(--primary); margin-bottom: 1rem;"></i>
                                    <h4>Revenue Trend</h4>
                                    <p style="font-size: 0.9rem; margin-top: 1rem;">Monthly revenue visualization</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-placeholder">
                                <div style="text-align: center;">
                                    <i class="fas fa-shopping-cart fa-3x" style="color: var(--secondary); margin-bottom: 1rem;"></i>
                                    <h4>Order Volume</h4>
                                    <p style="font-size: 0.9rem; margin-top: 1rem;">Weekly order statistics</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Page -->
            <div class="page-content" id="profile-page">
                <div class="dashboard-header">
                    <div class="welcome-message">
                        <h2>Your Profile</h2>
                        <p>Manage your account and farm information</p>
                    </div>
                    <button class="btn btn-primary" id="editProfileBtn">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
                
                <div class="profile-section">
                    <div class="profile-header">
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80" alt="Rajesh Kumar" class="profile-avatar">
                        <div class="profile-info">
                            <h2>Rajesh Kumar</h2>
                            <p><i class="fas fa-map-marker-alt"></i> Pune, Maharashtra</p>
                            <p><i class="fas fa-envelope"></i> rajesh@organicfarm.com</p>
                            <p><i class="fas fa-phone"></i> +91 98765 43210</p>
                            <div class="farmer-rating">
                                <i class="fas fa-star"></i> 4.8 Rating (128 reviews)
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-details">
                        <div>
                            <div class="detail-group">
                                <h4>Personal Information</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Full Name:</span>
                                    <span class="detail-value">Rajesh Kumar</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Email:</span>
                                    <span class="detail-value">rajesh@organicfarm.com</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Phone:</span>
                                    <span class="detail-value">+91 98765 43210</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Date of Birth:</span>
                                    <span class="detail-value">15 March 1985</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Gender:</span>
                                    <span class="detail-value">Male</span>
                                </div>
                            </div>
                            
                            <div class="detail-group">
                                <h4>Farm Details</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Farm Name:</span>
                                    <span class="detail-value">Organic Vegetable Farm</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Farm Type:</span>
                                    <span class="detail-value">Organic Farming</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Farm Size:</span>
                                    <span class="detail-value">15 acres</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Years Farming:</span>
                                    <span class="detail-value">8 years</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Certifications:</span>
                                    <span class="detail-value">Organic India, FSSAI</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="detail-group">
                                <h4>Address Information</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Address:</span>
                                    <span class="detail-value">Farm House No. 45</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Village/Town:</span>
                                    <span class="detail-value">Shindewadi</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Taluka:</span>
                                    <span class="detail-value">Mulshi</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">District:</span>
                                    <span class="detail-value">Pune</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">State:</span>
                                    <span class="detail-value">Maharashtra</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">PIN Code:</span>
                                    <span class="detail-value">412108</span>
                                </div>
                            </div>
                            
                            <div class="detail-group">
                                <h4>Bank Details</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Account Holder:</span>
                                    <span class="detail-value">Rajesh Kumar</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Account Number:</span>
                                    <span class="detail-value">XXXX XXXX 1234</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Bank Name:</span>
                                    <span class="detail-value">State Bank of India</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">IFSC Code:</span>
                                    <span class="detail-value">SBIN0001234</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Branch:</span>
                                    <span class="detail-value">Pune Main Branch</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <a href="#" class="mobile-nav-item active" data-page="dashboard">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
        </a>
        <a href="#" class="mobile-nav-item" data-page="products">
            <i class="fas fa-seedling"></i>
            <span>Products</span>
        </a>
        <a href="#" class="mobile-nav-item" data-page="tours">
            <i class="fas fa-map-marked-alt"></i>
            <span>Tours</span>
        </a>
        <a href="#" class="mobile-nav-item" data-page="analytics">
            <i class="fas fa-chart-line"></i>
            <span>Analytics</span>
        </a>
        <a href="#" class="mobile-nav-item" data-page="profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>
    
    <!-- Edit Product Modal -->
    <div class="modal" id="editProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Product Details</h3>
                <button class="close-btn" onclick="closeModal('editProductModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProductForm">
                    <div class="form-group">
                        <label for="editProductName">Product Name</label>
                        <input type="text" id="editProductName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editProductDescription">Description</label>
                        <textarea id="editProductDescription" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editProductPrice">Price (â‚¹)</label>
                        <input type="number" id="editProductPrice" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editProductStock">Stock Quantity</label>
                        <input type="number" id="editProductStock" min="0" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editProductModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveProductChanges()">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Tour Modal -->
    <div class="modal" id="editTourModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Tour Details</h3>
                <button class="close-btn" onclick="closeModal('editTourModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editTourForm">
                    <div class="form-group">
                        <label for="editTourName">Tour Name</label>
                        <input type="text" id="editTourName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTourDescription">Description</label>
                        <textarea id="editTourDescription" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTourLocation">Farm Location/Area</label>
                        <input type="text" id="editTourLocation" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTourDuration">Duration (hours)</label>
                        <input type="number" id="editTourDuration" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTourCapacity">Maximum Participants</label>
                        <input type="number" id="editTourCapacity" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTourPrice">Price per person (â‚¹)</label>
                        <input type="number" id="editTourPrice" min="0" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editTourModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveTourChanges()">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile Information</h3>
                <button class="close-btn" onclick="closeModal('editProfileModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="form-group">
                        <label for="editFullName">Full Name</label>
                        <input type="text" id="editFullName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editEmail">Email</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editPhone">Phone</label>
                        <input type="tel" id="editPhone" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editDateOfBirth">Date of Birth</label>
                        <input type="date" id="editDateOfBirth" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editGender">Gender</label>
                        <select id="editGender" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editFarmName">Farm Name</label>
                        <input type="text" id="editFarmName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editFarmType">Farm Type</label>
                        <input type="text" id="editFarmType" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editFarmSize">Farm Size (acres)</label>
                        <input type="number" id="editFarmSize" min="0" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editYearsFarming">Years Farming</label>
                        <input type="number" id="editYearsFarming" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCertifications">Certifications</label>
                        <input type="text" id="editCertifications" placeholder="Separate with commas">
                    </div>
                    
                    <div class="form-group">
                        <label for="editAddress">Address</label>
                        <input type="text" id="editAddress" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editVillage">Village/Town</label>
                        <input type="text" id="editVillage" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTaluka">Taluka</label>
                        <input type="text" id="editTaluka" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editDistrict">District</label>
                        <input type="text" id="editDistrict" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editState">State</label>
                        <input type="text" id="editState" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editPincode">PIN Code</label>
                        <input type="text" id="editPincode" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editAccountHolder">Account Holder Name</label>
                        <input type="text" id="editAccountHolder" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editAccountNumber">Account Number</label>
                        <input type="text" id="editAccountNumber" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editBankName">Bank Name</label>
                        <input type="text" id="editBankName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editIFSC">IFSC Code</label>
                        <input type="text" id="editIFSC" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editBranch">Branch</label>
                        <input type="text" id="editBranch" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editProfileModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveProfileChanges()">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Consignment Number Modal -->
    <div class="modal" id="consignmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Enter Consignment Details</h3>
                <button class="close-btn" onclick="closeModal('consignmentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="consignmentNumber">Consignment Number</label>
                    <input type="text" id="consignmentNumber" placeholder="Enter consignment number provided by courier" required>
                </div>
                <div class="form-group">
                    <label for="shipmentDate">Shipment Date</label>
                    <input type="date" id="shipmentDate" required>
                </div>
                <div class="form-group">
                    <label for="courierService">Courier Service</label>
                    <select id="courierService" required>
                        <option value="">Select Courier</option>
                        <option value="india-post">India Post</option>
                        <option value="dtdc">DTDC</option>
                        <option value="blue-dart">Blue Dart</option>
                        <option value="delhivery">Delhivery</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('consignmentModal')">Cancel</button>
                <button class="btn btn-primary" onclick="proceedToDocuments()">Generate Documents</button>
            </div>
        </div>
    </div>
    
    <!-- Documents Modal -->
    <div class="modal" id="documentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Download Shipping Documents</h3>
                <button class="close-btn" onclick="closeModal('documentsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shipping-options">
                    <div class="shipping-option selected" id="labelOption" onclick="selectShippingOption('label')">
                        <i class="fas fa-tag fa-2x"></i>
                        <h4>Shipping Label</h4>
                        <p>Download label with QR code</p>
                    </div>
                    <div class="shipping-option" id="invoiceOption" onclick="selectShippingOption('invoice')">
                        <i class="fas fa-file-invoice fa-2x"></i>
                        <h4>Product Invoice</h4>
                        <p>Download invoice with details</p>
                    </div>
                </div>
                
                <div id="labelPreview" class="preview-container">
                    <div class="label-preview">
                        <h4>Shipping Label Preview</h4>
                        <div class="qr-code" id="qrCodeContainer">
                            <!-- QR code will be generated here -->
                        </div>
                        <p><strong>Product:</strong> <span id="labelProductName"></span></p>
                        <p><strong>Consignment #:</strong> <span id="displayConsignmentNumber"></span></p>
                        <p><strong>Tracking #:</strong> <span id="trackingNumber">FT-987654321</span></p>
                        <p><strong>Ship to:</strong> FarmTrails Fulfillment Center, Pune</p>
                        <button class="btn btn-primary" onclick="downloadLabelAsPDF()">
                            <i class="fas fa-download"></i> Download Label as PDF
                        </button>
                    </div>
                </div>
                
                <div id="invoicePreview" class="preview-container" style="display: none;">
                    <div class="invoice-preview">
                        <h4>Product Invoice Preview</h4>
                        <table class="invoice-table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="invoiceProductName">Product Name</td>
                                    <td id="invoiceQuantity">1</td>
                                    <td id="invoicePrice">â‚¹0</td>
                                    <td id="invoiceTotal">â‚¹0</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="invoice-total">
                            Total Amount: <span id="invoiceTotalAmount">â‚¹0</span>
                        </div>
                        <button class="btn btn-primary" onclick="downloadInvoiceAsPDF()">
                            <i class="fas fa-download"></i> Download Invoice as PDF
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('documentsModal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmShipment()">
                    <i class="fas fa-check"></i> Confirm Shipment
                </button>
            </div>
        </div>
    </div>
    
    <!-- View Bookings Modal -->
    <div class="modal" id="viewBookingsModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>Tour Bookings</h3>
                <button class="close-btn" onclick="closeModal('viewBookingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="bookingsContent">
                    <!-- Bookings content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('viewBookingsModal')">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText"></span>
    </div>

    <!-- Hidden PDF Templates -->
    <div id="labelTemplate" class="pdf-template">
        <div style="text-align: center; border: 2px solid #4CAF50; padding: 20px; font-family: Arial, sans-serif;">
            <h2 style="color: #4CAF50; margin-bottom: 20px;">FarmTrails Shipping Label</h2>
            <div id="pdfQrCode" style="margin: 20px auto; width: 150px; height: 150px;"></div>
            <div style="text-align: left; margin: 20px 0;">
                <p><strong>Product:</strong> <span id="pdfProductName"></span></p>
                <p><strong>Consignment #:</strong> <span id="pdfConsignmentNumber"></span></p>
                <p><strong>Tracking #:</strong> <span id="pdfTrackingNumber">FT-987654321</span></p>
                <p><strong>Ship to:</strong> FarmTrails Fulfillment Center, Pune</p>
            </div>
            <div style="text-align: left; margin-top: 30px;">
                <h4 style="color: #4CAF50;">Shipping Instructions:</h4>
                <ul style="padding-left: 20px;">
                    <li>Attach this label to your shipment</li>
                    <li>Ship within 3 business days</li>
                    <li>Use proper packaging for agricultural products</li>
                    <li>Maintain cold chain for perishable items</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="invoiceTemplate" class="pdf-template">
        <div style="border: 2px solid #4CAF50; padding: 20px; font-family: Arial, sans-serif;">
            <h2 style="color: #4CAF50; text-align: center; margin-bottom: 20px;">FarmTrails Product Invoice</h2>
            <div style="margin-bottom: 20px;">
                <p><strong>Invoice Date:</strong> <span id="pdfInvoiceDate"></span></p>
                <p><strong>Invoice #:</strong> <span id="pdfInvoiceNumber">INV-${Math.floor(1000 + Math.random() * 9000)}</span></p>
                <p><strong>Farmer:</strong> Rajesh Kumar</p>
                <p><strong>Farm:</strong> Organic Vegetable Farm</p>
            </div>
            <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                <thead>
                    <tr style="background-color: #f5f5f5;">
                        <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Product</th>
                        <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Quantity</th>
                        <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Price</th>
                        <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;" id="pdfInvoiceProductName"></td>
                        <td style="border: 1px solid #ddd; padding: 10px;" id="pdfInvoiceQuantity"></td>
                        <td style="border: 1px solid #ddd; padding: 10px;" id="pdfInvoicePrice"></td>
                        <td style="border: 1px solid #ddd; padding: 10px;" id="pdfInvoiceTotal"></td>
                    </tr>
                </tbody>
            </table>
            <div style="text-align: right; margin-top: 20px;">
                <h3>Total Amount: <span id="pdfInvoiceTotalAmount"></span></h3>
            </div>
            <div style="margin-top: 30px;">
                <h4 style="color: #4CAF50;">Shipping Information:</h4>
                <p>FarmTrails Fulfillment Center</p>
                <p>123 Agriculture Park, Food Processing Zone</p>
                <p>Pune, Maharashtra 411045</p>
            </div>
            <div style="margin-top: 20px;">
                <h4 style="color: #4CAF50;">Notes:</h4>
                <ul style="padding-left: 20px;">
                    <li>This invoice is for product shipment to fulfillment center</li>
                    <li>Products must be shipped within 3 business days</li>
                    <li>Maintain proper packaging and cold chain if required</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = window.CONFIG ? window.CONFIG.SUPABASE_URL : '';
        const SUPABASE_ANON_KEY = window.CONFIG ? window.CONFIG.SUPABASE_ANON_KEY : '';
        
        // Initialize Supabase client (with error handling)
        let supabase = null;
        try {
            if (window.supabase && SUPABASE_URL && SUPABASE_ANON_KEY) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            } else {
                console.warn('Supabase is not configured. Some features may not work.');
                // Create a mock supabase object that returns empty results
                supabase = {
                    from: function(table) {
                        return {
                            select: function() { return this; },
                            insert: function() { return this; },
                            update: function() { return this; },
                            delete: function() { return this; },
                            eq: function() { return this; },
                            single: function() { return Promise.resolve({ data: null, error: null }); },
                            order: function() { return this; },
                            limit: function() { return this; },
                            then: function(resolve) { 
                                resolve({ data: [], error: null }); 
                                return this;
                            }
                        };
                    }
                };
            }
        } catch (error) {
            console.error('Failed to initialize Supabase:', error);
            // Create a mock supabase object that returns empty results
            supabase = {
                from: function(table) {
                    return {
                        select: function() { return this; },
                        insert: function() { return this; },
                        update: function() { return this; },
                        delete: function() { return this; },
                        eq: function() { return this; },
                        single: function() { return Promise.resolve({ data: null, error: null }); },
                        order: function() { return this; },
                        limit: function() { return this; },
                        then: function(resolve) { 
                            resolve({ data: [], error: null }); 
                            return this;
                        }
                    };
                }
            };
        }
        
        // Farmer ID (in a real app, this would come from authentication)
        const FARMER_ID = 'farmer_rajesh_kumar';
        
        // Track if farmer is new (no products or tours)
        let isNewFarmer = true;
        
        // Current product being processed
        let currentProduct = null;
        let currentConsignmentNumber = '';
        let currentTour = null;
        
        // Sample data for dashboard (in real app, this would come from Supabase)
        const sampleOrders = [
            {
                id: 'ORD-1025',
                customer_name: 'Priya Sharma',
                product_name: 'Organic Tomatoes (2kg)',
                date: '2023-09-15',
                amount: 160,
                status: 'confirmed'
            },
            {
                id: 'ORD-1024',
                customer_name: 'Rahul Verma',
                product_name: 'Turmeric Powder (500gm)',
                date: '2023-09-14',
                amount: 350,
                status: 'pending'
            },
            {
                id: 'ORD-1023',
                customer_name: 'Anita Desai',
                product_name: 'Fresh Honey (1kg)',
                date: '2023-09-13',
                amount: 900,
                status: 'shipped'
            },
            {
                id: 'ORD-1022',
                customer_name: 'Sanjay Patel',
                product_name: 'Natural Jaggery (1kg)',
                date: '2023-09-12',
                amount: 300,
                status: 'delivered'
            },
            {
                id: 'ORD-1021',
                customer_name: 'Meera Joshi',
                product_name: 'Organic Potatoes (3kg)',
                date: '2023-09-11',
                amount: 120,
                status: 'confirmed'
            }
        ];

        // Page Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active navigation
            document.querySelectorAll('.desktop-nav-item, .sidebar-menu a, .mobile-nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            document.querySelectorAll(`[data-page="${pageId.replace('-page', '')}"]`).forEach(nav => {
                nav.classList.add('active');
            });
            
            // Close mobile sidebar if open
            document.getElementById('sidebar').classList.remove('mobile-open');
            document.getElementById('headerRight').classList.remove('mobile-open');
            
            // Load products if products page
            if (pageId === 'products-page') {
                loadProducts();
            }
            
            // Load tours if tours page
            if (pageId === 'tours-page') {
                loadTours();
            }
            
            // Load dashboard data if dashboard page
            if (pageId === 'dashboard-page') {
                loadDashboardData();
            }
            
            // Load analytics if analytics page
            if (pageId === 'analytics-page') {
                loadAnalytics();
            }
        }
        
        // Initialize page navigation
        document.querySelectorAll('[data-page]').forEach(nav => {
            nav.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.getAttribute('data-page');
                showPage(`${page}-page`);
            });
        });
        
        // Mobile menu functionality
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const headerRight = document.getElementById('headerRight');
            headerRight.classList.toggle('mobile-open');
            
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        });

        // Add Product Button
        document.getElementById('addProductBtn').addEventListener('click', function() {
            showPage('products-page');
            document.getElementById('addProductForm').style.display = 'block';
        });
        
        document.getElementById('addProductBtn2').addEventListener('click', function() {
            document.getElementById('addProductForm').style.display = 'block';
        });
        
        document.getElementById('cancelProductBtn').addEventListener('click', function() {
            document.getElementById('addProductForm').style.display = 'none';
            document.getElementById('productForm').reset();
        });
        
        // Add Tour Button
        document.getElementById('addTourBtn').addEventListener('click', function() {
            document.getElementById('addTourForm').style.display = 'block';
        });
        
        document.getElementById('cancelTourBtn').addEventListener('click', function() {
            document.getElementById('addTourForm').style.display = 'none';
            document.getElementById('tourForm').reset();
        });
        
        // Edit Profile Button
        document.getElementById('editProfileBtn').addEventListener('click', function() {
            openEditProfileModal();
        });
        
        // Image Upload Functionality
        document.getElementById('productImage').addEventListener('change', function(e) {
            if (e.target.files.length) {
                const file = e.target.files[0];
                
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showNotification('Please select an image file', 'error');
                    return;
                }
                
                // Preview image
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImage').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('uploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Tour Image Upload Functionality
        document.getElementById('tourImage').addEventListener('change', function(e) {
            if (e.target.files.length) {
                const file = e.target.files[0];
                
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showNotification('Please select an image file', 'error');
                    return;
                }
                
                // Preview image
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('tourPreviewImage').src = e.target.result;
                    document.getElementById('tourImagePreview').style.display = 'block';
                    document.getElementById('tourUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Form Submission with Supabase Integration
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form values
            const productName = document.getElementById('productName').value;
            const description = document.getElementById('productDescription').value;
            const category = document.getElementById('productCategory').value;
            const price = document.getElementById('productPrice').value;
            const unit = document.getElementById('productUnit').value;
            const stock = document.getElementById('productStock').value;
            const weight = document.getElementById('productWeight').value;
            const image = document.getElementById('previewImage').src || 'https://images.unsplash.com/photo-1615485500834-bc10199bc727?q=80&w=880&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D';
            
            try {
                // Insert product into Supabase
                const { data, error } = await supabase
                    .from('products')
                    .insert([
                        {
                            farmer_id: FARMER_ID,
                            name: productName,
                            description: description,
                            category: category,
                            price: price,
                            unit: unit,
                            stock: stock,
                            weight: weight,
                            image_url: image,
                            status: 'active',
                            fulfillment_status: 'not_sent',
                            created_at: new Date().toISOString()
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                // Update new farmer status
                isNewFarmer = false;
                
                // Show success message
                showNotification(`Product "${productName}" added successfully!`);
                
                // Reset and hide form
                document.getElementById('productForm').reset();
                document.getElementById('addProductForm').style.display = 'none';
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('uploadText').style.display = 'block';
                
                // Reload products
                loadProducts();
                
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('Error adding product. Please try again.', 'error');
            }
        });
        
        // Tour Form Submission with Supabase Integration
        document.getElementById('tourForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form values
            const tourName = document.getElementById('tourName').value;
            const tourLocation = document.getElementById('tourLocation').value;
            const tourDuration = document.getElementById('tourDuration').value;
            const tourCapacity = document.getElementById('tourCapacity').value;
            const tourPrice = document.getElementById('tourPrice').value;
            const tourDescription = document.getElementById('tourDescription').value;
            const image = document.getElementById('tourPreviewImage').src || 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D';
            
            try {
                // Insert tour into Supabase
                const { data, error } = await supabase
                    .from('tours')
                    .insert([
                        {
                            farmer_id: FARMER_ID,
                            name: tourName,
                            description: tourDescription,
                            location: tourLocation,
                            duration: tourDuration,
                            capacity: tourCapacity,
                            price: tourPrice,
                            image_url: image,
                            status: 'active',
                            created_at: new Date().toISOString()
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                // Update new farmer status
                isNewFarmer = false;
                
                // Show success message
                showNotification(`Tour "${tourName}" for location "${tourLocation}" added successfully!`);
                
                // Reset and hide form
                document.getElementById('tourForm').reset();
                document.getElementById('addTourForm').style.display = 'none';
                document.getElementById('tourImagePreview').style.display = 'none';
                document.getElementById('tourUploadText').style.display = 'block';
                
                // Reload tours
                loadTours();
                
            } catch (error) {
                console.error('Error adding tour:', error);
                showNotification('Error adding tour. Please try again.', 'error');
            }
        });
        
        // Load Products Function with Supabase
        async function loadProducts() {
            const productsContainer = document.getElementById('productsContainer');
            const emptyState = document.getElementById('productsEmptyState');
            
            productsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><p>Loading products...</p></div>';
            emptyState.style.display = 'none';
            
            try {
                // Fetch products from Supabase
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('farmer_id', FARMER_ID)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                productsContainer.innerHTML = '';
                
                if (products.length === 0) {
                    productsContainer.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }
                
                productsContainer.style.display = 'grid';
                emptyState.style.display = 'none';
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.id = `product-${product.id}`;
                    
                    let statusText, statusClass;
                    switch(product.fulfillment_status) {
                        case 'not_sent':
                            statusText = 'Not Sent to Center';
                            statusClass = 'status-not-sent';
                            break;
                        case 'pending':
                            statusText = 'Awaiting Shipment';
                            statusClass = 'status-pending';
                            break;
                        case 'in_transit':
                            statusText = 'In Transit';
                            statusClass = 'status-in-transit';
                            break;
                        case 'received':
                            statusText = 'Received at Center';
                            statusClass = 'status-received';
                            break;
                        default:
                            statusText = 'Not Sent to Center';
                            statusClass = 'status-not-sent';
                    }
                    
                    productCard.innerHTML = `
                        <img src="${product.image_url}" alt="${product.name}" class="product-image">
                        <div class="product-content">
                            <h3 class="product-title">${product.name}</h3>
                            <div class="product-price">â‚¹${product.price}/${product.unit}</div>
                            <div class="product-stock">Stock: ${product.stock} units</div>
                            <div class="fulfillment-status">
                                <strong>Fulfillment:</strong> 
                                <span class="shipment-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="product-actions">
                                ${getProductActions(product)}
                            </div>
                        </div>
                    `;
                    
                    productsContainer.appendChild(productCard);
                });
                
            } catch (error) {
                console.error('Error loading products:', error);
                productsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Error Loading Products</h3>
                        <p>Could not load products. Please try again.</p>
                        <button class="btn btn-primary" onclick="loadProducts()">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }
        
        // Load Tours Function with Supabase
        async function loadTours() {
            const toursContainer = document.getElementById('toursContainer');
            const emptyState = document.getElementById('toursEmptyState');
            
            toursContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><p>Loading tours...</p></div>';
            emptyState.style.display = 'none';
            
            try {
                // Fetch tours from Supabase
                const { data: tours, error } = await supabase
                    .from('tours')
                    .select('*')
                    .eq('farmer_id', FARMER_ID)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                // Fetch booking counts for each tour
                const toursWithBookings = await Promise.all(
                    tours.map(async (tour) => {
                        const { count, error: bookingError } = await supabase
                            .from('bookings')
                            .select('*', { count: 'exact', head: true })
                            .eq('tour_id', tour.id);
                        
                        if (bookingError) {
                            console.error('Error fetching booking count:', bookingError);
                            return { ...tour, bookingCount: 0 };
                        }
                        
                        return { ...tour, bookingCount: count || 0 };
                    })
                );
                
                toursContainer.innerHTML = '';
                
                if (toursWithBookings.length === 0) {
                    toursContainer.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }
                
                toursContainer.style.display = 'grid';
                emptyState.style.display = 'none';
                
                toursWithBookings.forEach(tour => {
                    const tourCard = document.createElement('div');
                    tourCard.className = 'tour-card';
                    tourCard.id = `tour-${tour.id}`;
                    
                    tourCard.innerHTML = `
                        <img src="${tour.image_url}" alt="${tour.name}" class="tour-image">
                        <div class="tour-content">
                            <h3 class="tour-title">${tour.name}</h3>
                            <div class="tour-meta">
                                <span><i class="fas fa-clock"></i> ${tour.duration} hours</span>
                                <span><i class="fas fa-users"></i> ${tour.capacity} people</span>
                                <span><i class="fas fa-map-marker-alt"></i> ${tour.location}</span>
                            </div>
                            <p class="tour-description">${tour.description}</p>
                            <div class="tour-price">â‚¹${tour.price} per person</div>
                            <div class="tour-meta">
                                <span><i class="fas fa-calendar-check"></i> ${tour.bookingCount} Bookings</span>
                            </div>
                            <div class="product-actions">
                                <button class="action-btn btn-edit" onclick="editTour('${tour.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="action-btn btn-view" onclick="viewBookings('${tour.id}')">
                                    <i class="fas fa-eye"></i> View Bookings
                                </button>
                            </div>
                        </div>
                    `;
                    
                    toursContainer.appendChild(tourCard);
                });
                
            } catch (error) {
                console.error('Error loading tours:', error);
                toursContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Error Loading Tours</h3>
                        <p>Could not load tours. Please try again.</p>
                        <button class="btn btn-primary" onclick="loadTours()">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }
        
        // Load Dashboard Data with Supabase
        async function loadDashboardData() {
            try {
                // Fetch dashboard stats
                const { data: products, error: productsError } = await supabase
                    .from('products')
                    .select('*')
                    .eq('farmer_id', FARMER_ID);
                
                const { data: tours, error: toursError } = await supabase
                    .from('tours')
                    .select('*')
                    .eq('farmer_id', FARMER_ID);
                
                const { data: bookings, error: bookingsError } = await supabase
                    .from('bookings')
                    .select('*')
                    .eq('farmer_id', FARMER_ID);
                
                const { data: orders, error: ordersError } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('farmer_id', FARMER_ID)
                    .order('created_at', { ascending: false })
                    .limit(5);
                
                if (productsError || toursError || bookingsError || ordersError) {
                    throw new Error('Error fetching dashboard data');
                }
                
                // Check if farmer is new (no products or tours)
                isNewFarmer = (!products || products.length === 0) && (!tours || tours.length === 0);
                
                // Show/hide new farmer welcome section
                const newFarmerWelcome = document.getElementById('newFarmerWelcome');
                const fulfillmentSection = document.getElementById('fulfillmentSection');
                const recentOrdersSection = document.getElementById('recentOrdersSection');
                
                if (isNewFarmer) {
                    newFarmerWelcome.style.display = 'block';
                    fulfillmentSection.style.display = 'none';
                    recentOrdersSection.style.display = 'none';
                } else {
                    newFarmerWelcome.style.display = 'none';
                    fulfillmentSection.style.display = 'block';
                    recentOrdersSection.style.display = 'block';
                }
                
                // Update stats
                document.getElementById('productsCount').textContent = products?.length || 0;
                document.getElementById('upcomingBookings').textContent = bookings?.filter(b => b.status === 'confirmed').length || 0;
                
                // Calculate monthly revenue (simplified)
                const monthlyRevenue = orders?.reduce((sum, order) => sum + (order.total_amount || 0), 0) || 8500;
                document.getElementById('monthlyRevenue').textContent = `â‚¹${monthlyRevenue}`;
                
                // Update fulfillment stats
                const productsAtCenter = products?.filter(p => p.fulfillment_status === 'received').length || 4;
                const inTransit = products?.filter(p => p.fulfillment_status === 'in_transit').length || 1;
                const awaitingShipment = products?.filter(p => p.fulfillment_status === 'pending').length || 1;
                const delivered = orders?.filter(o => o.status === 'delivered').length || 15;
                
                document.getElementById('productsAtCenter').textContent = productsAtCenter;
                document.getElementById('inTransit').textContent = inTransit;
                document.getElementById('awaitingShipment').textContent = awaitingShipment;
                document.getElementById('delivered').textContent = delivered;
                
                // Update recent orders
                const recentOrdersContainer = document.getElementById('recentOrders');
                if (sampleOrders && sampleOrders.length > 0) {
                    recentOrdersContainer.innerHTML = sampleOrders.map(order => `
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.customer_name}</td>
                            <td>${order.product_name}</td>
                            <td>${order.date}</td>
                            <td>â‚¹${order.amount}</td>
                            <td><span class="status status-${order.status}">${order.status.charAt(0).toUpperCase() + order.status.slice(1)}</span></td>
                        </tr>
                    `).join('');
                } else {
                    recentOrdersContainer.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--gray);">
                                No recent orders
                            </td>
                        </tr>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading dashboard data', 'error');
            }
        }
        
        // Load Analytics with empty state handling
        async function loadAnalytics() {
            const analyticsContent = document.getElementById('analyticsContent');
            const analyticsEmptyState = document.getElementById('analyticsEmptyState');
            
            try {
                // Check if we have any data
                const { data: products, error: productsError } = await supabase
                    .from('products')
                    .select('*', { count: 'exact', head: true })
                    .eq('farmer_id', FARMER_ID);
                
                const { data: tours, error: toursError } = await supabase
                    .from('tours')
                    .select('*', { count: 'exact', head: true })
                    .eq('farmer_id', FARMER_ID);
                
                const { data: orders, error: ordersError } = await supabase
                    .from('orders')
                    .select('*', { count: 'exact', head: true })
                    .eq('farmer_id', FARMER_ID);
                
                if (productsError || toursError || ordersError) {
                    throw new Error('Error checking analytics data');
                }
                
                const hasData = (products && products.length > 0) || 
                               (tours && tours.length > 0) || 
                               (orders && orders.length > 0);
                
                if (hasData) {
                    analyticsContent.style.display = 'block';
                    analyticsEmptyState.style.display = 'none';
                } else {
                    analyticsContent.style.display = 'none';
                    analyticsEmptyState.style.display = 'block';
                }
                
            } catch (error) {
                console.error('Error loading analytics:', error);
                analyticsContent.style.display = 'none';
                analyticsEmptyState.style.display = 'block';
            }
        }
        
        // Open Edit Profile Modal
        function openEditProfileModal() {
            // Set current values in the form
            document.getElementById('editFullName').value = 'Rajesh Kumar';
            document.getElementById('editEmail').value = 'rajesh@organicfarm.com';
            document.getElementById('editPhone').value = '+91 98765 43210';
            document.getElementById('editDateOfBirth').value = '1985-03-15';
            document.getElementById('editGender').value = 'male';
            document.getElementById('editFarmName').value = 'Organic Vegetable Farm';
            document.getElementById('editFarmType').value = 'Organic Farming';
            document.getElementById('editFarmSize').value = '15';
            document.getElementById('editYearsFarming').value = '8';
            document.getElementById('editCertifications').value = 'Organic India, FSSAI';
            document.getElementById('editAddress').value = 'Farm House No. 45';
            document.getElementById('editVillage').value = 'Shindewadi';
            document.getElementById('editTaluka').value = 'Mulshi';
            document.getElementById('editDistrict').value = 'Pune';
            document.getElementById('editState').value = 'Maharashtra';
            document.getElementById('editPincode').value = '412108';
            document.getElementById('editAccountHolder').value = 'Rajesh Kumar';
            document.getElementById('editAccountNumber').value = 'XXXX XXXX 1234';
            document.getElementById('editBankName').value = 'State Bank of India';
            document.getElementById('editIFSC').value = 'SBIN0001234';
            document.getElementById('editBranch').value = 'Pune Main Branch';
            
            openModal('editProfileModal');
        }
        
        // Save Profile Changes
        async function saveProfileChanges() {
            try {
                // Get form values
                const fullName = document.getElementById('editFullName').value;
                const email = document.getElementById('editEmail').value;
                const phone = document.getElementById('editPhone').value;
                const dateOfBirth = document.getElementById('editDateOfBirth').value;
                const gender = document.getElementById('editGender').value;
                const farmName = document.getElementById('editFarmName').value;
                const farmType = document.getElementById('editFarmType').value;
                const farmSize = document.getElementById('editFarmSize').value;
                const yearsFarming = document.getElementById('editYearsFarming').value;
                const certifications = document.getElementById('editCertifications').value;
                const address = document.getElementById('editAddress').value;
                const village = document.getElementById('editVillage').value;
                const taluka = document.getElementById('editTaluka').value;
                const district = document.getElementById('editDistrict').value;
                const state = document.getElementById('editState').value;
                const pincode = document.getElementById('editPincode').value;
                const accountHolder = document.getElementById('editAccountHolder').value;
                const accountNumber = document.getElementById('editAccountNumber').value;
                const bankName = document.getElementById('editBankName').value;
                const ifsc = document.getElementById('editIFSC').value;
                const branch = document.getElementById('editBranch').value;
                
                // In a real app, we would update this in Supabase
                // For now, we'll just show a success message
                
                showNotification('Profile updated successfully!');
                closeModal('editProfileModal');
                
                // Update the profile page with new values
                updateProfileDisplay({
                    fullName, email, phone, dateOfBirth, gender, farmName, farmType, 
                    farmSize, yearsFarming, certifications, address, village, taluka,
                    district, state, pincode, accountHolder, accountNumber, bankName, ifsc, branch
                });
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showNotification('Error updating profile. Please try again.', 'error');
            }
        }
        
        // Update Profile Display
        function updateProfileDisplay(profileData) {
            // Update profile header
            document.querySelector('.profile-info h2').textContent = profileData.fullName;
            document.querySelector('.profile-info p:nth-child(3)').innerHTML = `<i class="fas fa-envelope"></i> ${profileData.email}`;
            document.querySelector('.profile-info p:nth-child(4)').innerHTML = `<i class="fas fa-phone"></i> ${profileData.phone}`;
            
            // Update personal information
            document.querySelector('.detail-item:nth-child(1) .detail-value').textContent = profileData.fullName;
            document.querySelector('.detail-item:nth-child(2) .detail-value').textContent = profileData.email;
            document.querySelector('.detail-item:nth-child(3) .detail-value').textContent = profileData.phone;
            document.querySelector('.detail-item:nth-child(4) .detail-value').textContent = new Date(profileData.dateOfBirth).toLocaleDateString('en-IN');
            document.querySelector('.detail-item:nth-child(5) .detail-value').textContent = profileData.gender.charAt(0).toUpperCase() + profileData.gender.slice(1);
            
            // Update farm details
            document.querySelector('.detail-group:nth-child(2) .detail-item:nth-child(1) .detail-value').textContent = profileData.farmName;
            document.querySelector('.detail-group:nth-child(2) .detail-item:nth-child(2) .detail-value').textContent = profileData.farmType;
            document.querySelector('.detail-group:nth-child(2) .detail-item:nth-child(3) .detail-value').textContent = `${profileData.farmSize} acres`;
            document.querySelector('.detail-group:nth-child(2) .detail-item:nth-child(4) .detail-value').textContent = `${profileData.yearsFarming} years`;
            document.querySelector('.detail-group:nth-child(2) .detail-item:nth-child(5) .detail-value').textContent = profileData.certifications;
            
            // Update address information
            document.querySelector('.detail-group:nth-child(3) .detail-item:nth-child(1) .detail-value').textContent = profileData.address;
            document.querySelector('.detail-group:nth-child(3) .detail-item:nth-child(2) .detail-value').textContent = profileData.village;
                        document.querySelector('.detail-group:nth-child(3) .detail-item:nth-child(3) .detail-value').textContent = profileData.taluka;
            document.querySelector('.detail-group:nth-child(3) .detail-item:nth-child(4) .detail-value').textContent = profileData.district;
            document.querySelector('.detail-group:nth-child(3) .detail-item:nth-child(5) .detail-value').textContent = profileData.state;
            document.querySelector('.detail-group:nth-child(3) .detail-item:nth-child(6) .detail-value').textContent = profileData.pincode;
            
            // Update bank details
            document.querySelector('.detail-group:nth-child(4) .detail-item:nth-child(1) .detail-value').textContent = profileData.accountHolder;
            document.querySelector('.detail-group:nth-child(4) .detail-item:nth-child(2) .detail-value').textContent = profileData.accountNumber;
            document.querySelector('.detail-group:nth-child(4) .detail-item:nth-child(3) .detail-value').textContent = profileData.bankName;
            document.querySelector('.detail-group:nth-child(4) .detail-item:nth-child(4) .detail-value').textContent = profileData.ifsc;
            document.querySelector('.detail-group:nth-child(4) .detail-item:nth-child(5) .detail-value').textContent = profileData.branch;
        }
        
        // Get Product Actions based on fulfillment status
        function getProductActions(product) {
            let actions = '';
            
            switch(product.fulfillment_status) {
                case 'not_sent':
                    actions = `
                        <button class="action-btn btn-ship" onclick="shipProduct('${product.id}')">
                            <i class="fas fa-shipping-fast"></i> Ship to Center
                        </button>
                        <button class="action-btn btn-edit" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn btn-delete" onclick="deleteProduct('${product.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    `;
                    break;
                case 'pending':
                    actions = `
                        <button class="action-btn btn-ship" onclick="shipProduct('${product.id}')">
                            <i class="fas fa-truck"></i> Update Shipment
                        </button>
                        <button class="action-btn btn-view" onclick="viewShipmentDetails('${product.id}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    `;
                    break;
                case 'in_transit':
                    actions = `
                        <button class="action-btn btn-view" onclick="viewShipmentDetails('${product.id}')">
                            <i class="fas fa-eye"></i> Track Shipment
                        </button>
                    `;
                    break;
                case 'received':
                    actions = `
                        <span style="color: var(--primary); font-weight: bold;">
                            <i class="fas fa-check-circle"></i> Received at Center
                        </span>
                    `;
                    break;
                default:
                    actions = `
                        <button class="action-btn btn-ship" onclick="shipProduct('${product.id}')">
                            <i class="fas fa-shipping-fast"></i> Ship to Center
                        </button>
                        <button class="action-btn btn-edit" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    `;
            }
            
            return actions;
        }
        
        // Ship Product Function
        async function shipProduct(productId) {
            try {
                // Fetch product details
                const { data: product, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('id', productId)
                    .single();
                
                if (error) throw error;
                
                currentProduct = product;
                openModal('consignmentModal');
                
            } catch (error) {
                console.error('Error fetching product:', error);
                showNotification('Error loading product details', 'error');
            }
        }
        
        // Proceed to Documents
        function proceedToDocuments() {
            const consignmentNumber = document.getElementById('consignmentNumber').value;
            const shipmentDate = document.getElementById('shipmentDate').value;
            const courierService = document.getElementById('courierService').value;
            
            if (!consignmentNumber || !shipmentDate || !courierService) {
                showNotification('Please fill all consignment details', 'error');
                return;
            }
            
            currentConsignmentNumber = consignmentNumber;
            
            // Update product status to pending
            updateProductStatus(currentProduct.id, 'pending');
            
            // Close consignment modal and open documents modal
            closeModal('consignmentModal');
            openModal('documentsModal');
            
            // Generate QR code
            generateQRCode();
            
            // Update previews
            document.getElementById('labelProductName').textContent = currentProduct.name;
            document.getElementById('displayConsignmentNumber').textContent = currentConsignmentNumber;
            document.getElementById('invoiceProductName').textContent = currentProduct.name;
            document.getElementById('invoiceQuantity').textContent = '1';
            document.getElementById('invoicePrice').textContent = `â‚¹${currentProduct.price}`;
            document.getElementById('invoiceTotal').textContent = `â‚¹${currentProduct.price}`;
            document.getElementById('invoiceTotalAmount').textContent = `â‚¹${currentProduct.price}`;
        }
        
        // Update Product Status
        async function updateProductStatus(productId, status) {
            try {
                const { error } = await supabase
                    .from('products')
                    .update({ fulfillment_status: status })
                    .eq('id', productId);
                
                if (error) throw error;
                
                // Reload products to reflect status change
                loadProducts();
                
            } catch (error) {
                console.error('Error updating product status:', error);
            }
        }
        
        // Generate QR Code
        function generateQRCode() {
            const qrCodeContainer = document.getElementById('qrCodeContainer');
            qrCodeContainer.innerHTML = '';
            
            const qr = qrcode(0, 'M');
            qr.addData(`FarmTrails|Product:${currentProduct.id}|Consignment:${currentConsignmentNumber}`);
            qr.make();
            
            qrCodeContainer.innerHTML = qr.createImgTag(5);
        }
        
        // Select Shipping Option
        function selectShippingOption(option) {
            document.getElementById('labelOption').classList.remove('selected');
            document.getElementById('invoiceOption').classList.remove('selected');
            document.getElementById('labelPreview').style.display = 'none';
            document.getElementById('invoicePreview').style.display = 'none';
            
            if (option === 'label') {
                document.getElementById('labelOption').classList.add('selected');
                document.getElementById('labelPreview').style.display = 'block';
            } else {
                document.getElementById('invoiceOption').classList.add('selected');
                document.getElementById('invoicePreview').style.display = 'block';
            }
        }
        
        // Download Label as PDF
        function downloadLabelAsPDF() {
            // Prepare PDF template
            document.getElementById('pdfProductName').textContent = currentProduct.name;
            document.getElementById('pdfConsignmentNumber').textContent = currentConsignmentNumber;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get the label template HTML
            const labelTemplate = document.getElementById('labelTemplate').innerHTML;
            
            // Use html2canvas to capture the template as image
            html2canvas(document.getElementById('labelTemplate')).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                doc.addImage(imgData, 'PNG', 10, 10, 190, 0);
                doc.save(`shipping-label-${currentConsignmentNumber}.pdf`);
                showNotification('Shipping label downloaded successfully!');
            });
        }
        
        // Download Invoice as PDF
        function downloadInvoiceAsPDF() {
            // Prepare PDF template
            document.getElementById('pdfInvoiceProductName').textContent = currentProduct.name;
            document.getElementById('pdfInvoiceQuantity').textContent = '1';
            document.getElementById('pdfInvoicePrice').textContent = `â‚¹${currentProduct.price}`;
            document.getElementById('pdfInvoiceTotal').textContent = `â‚¹${currentProduct.price}`;
            document.getElementById('pdfInvoiceTotalAmount').textContent = `â‚¹${currentProduct.price}`;
            document.getElementById('pdfInvoiceDate').textContent = new Date().toLocaleDateString('en-IN');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Use html2canvas to capture the template as image
            html2canvas(document.getElementById('invoiceTemplate')).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                doc.addImage(imgData, 'PNG', 10, 10, 190, 0);
                doc.save(`invoice-${currentConsignmentNumber}.pdf`);
                showNotification('Invoice downloaded successfully!');
            });
        }
        
        // Confirm Shipment
        async function confirmShipment() {
            try {
                // Update product status to in_transit
                await updateProductStatus(currentProduct.id, 'in_transit');
                
                showNotification('Shipment confirmed! Product is now in transit to fulfillment center.');
                closeModal('documentsModal');
                
            } catch (error) {
                console.error('Error confirming shipment:', error);
                showNotification('Error confirming shipment', 'error');
            }
        }
        
        // Edit Product
        async function editProduct(productId) {
            try {
                // Fetch product details
                const { data: product, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('id', productId)
                    .single();
                
                if (error) throw error;
                
                // Set form values
                document.getElementById('editProductName').value = product.name;
                document.getElementById('editProductDescription').value = product.description;
                document.getElementById('editProductPrice').value = product.price;
                document.getElementById('editProductStock').value = product.stock;
                
                // Store current product ID
                document.getElementById('editProductForm').dataset.productId = productId;
                
                openModal('editProductModal');
                
            } catch (error) {
                console.error('Error fetching product:', error);
                showNotification('Error loading product details', 'error');
            }
        }
        
        // Save Product Changes
        async function saveProductChanges() {
            const productId = document.getElementById('editProductForm').dataset.productId;
            const name = document.getElementById('editProductName').value;
            const description = document.getElementById('editProductDescription').value;
            const price = document.getElementById('editProductPrice').value;
            const stock = document.getElementById('editProductStock').value;
            
            try {
                const { error } = await supabase
                    .from('products')
                    .update({
                        name: name,
                        description: description,
                        price: price,
                        stock: stock,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', productId);
                
                if (error) throw error;
                
                showNotification('Product updated successfully!');
                closeModal('editProductModal');
                loadProducts();
                
            } catch (error) {
                console.error('Error updating product:', error);
                showNotification('Error updating product', 'error');
            }
        }
        
        // Delete Product
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', productId);
                
                if (error) throw error;
                
                showNotification('Product deleted successfully!');
                loadProducts();
                
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('Error deleting product', 'error');
            }
        }
        
        // Edit Tour
        async function editTour(tourId) {
            try {
                // Fetch tour details
                const { data: tour, error } = await supabase
                    .from('tours')
                    .select('*')
                    .eq('id', tourId)
                    .single();
                
                if (error) throw error;
                
                // Set form values
                document.getElementById('editTourName').value = tour.name;
                document.getElementById('editTourDescription').value = tour.description;
                document.getElementById('editTourLocation').value = tour.location;
                document.getElementById('editTourDuration').value = tour.duration;
                document.getElementById('editTourCapacity').value = tour.capacity;
                document.getElementById('editTourPrice').value = tour.price;
                
                // Store current tour ID
                document.getElementById('editTourForm').dataset.tourId = tourId;
                
                openModal('editTourModal');
                
            } catch (error) {
                console.error('Error fetching tour:', error);
                showNotification('Error loading tour details', 'error');
            }
        }
        
        // Save Tour Changes
        async function saveTourChanges() {
            const tourId = document.getElementById('editTourForm').dataset.tourId;
            const name = document.getElementById('editTourName').value;
            const description = document.getElementById('editTourDescription').value;
            const location = document.getElementById('editTourLocation').value;
            const duration = document.getElementById('editTourDuration').value;
            const capacity = document.getElementById('editTourCapacity').value;
            const price = document.getElementById('editTourPrice').value;
            
            try {
                const { error } = await supabase
                    .from('tours')
                    .update({
                        name: name,
                        description: description,
                        location: location,
                        duration: duration,
                        capacity: capacity,
                        price: price,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', tourId);
                
                if (error) throw error;
                
                showNotification('Tour updated successfully!');
                closeModal('editTourModal');
                loadTours();
                
            } catch (error) {
                console.error('Error updating tour:', error);
                showNotification('Error updating tour', 'error');
            }
        }
        
        // View Bookings for a Tour
        async function viewBookings(tourId) {
            try {
                // Fetch tour details
                const { data: tour, error: tourError } = await supabase
                    .from('tours')
                    .select('*')
                    .eq('id', tourId)
                    .single();
                
                // Fetch bookings for this tour
                const { data: bookings, error: bookingsError } = await supabase
                    .from('bookings')
                    .select('*')
                    .eq('tour_id', tourId)
                    .order('created_at', { ascending: false });
                
                if (tourError || bookingsError) throw new Error('Error fetching bookings');
                
                currentTour = tour;
                
                // Display bookings
                const bookingsContent = document.getElementById('bookingsContent');
                
                if (bookings.length === 0) {
                    bookingsContent.innerHTML = `
                        <div class="no-bookings">
                            <i class="fas fa-calendar-times fa-3x" style="color: var(--gray-light); margin-bottom: 1rem;"></i>
                            <h3>No Bookings Yet</h3>
                            <p>No customers have booked this tour yet.</p>
                        </div>
                    `;
                } else {
                    let bookingsHTML = `
                        <div class="bookings-summary">
                            <div class="summary-card">
                                <h3>${bookings.length}</h3>
                                <p>Total Bookings</p>
                            </div>
                            <div class="summary-card">
                                <h3>${bookings.filter(b => b.status === 'confirmed').length}</h3>
                                <p>Confirmed</p>
                            </div>
                            <div class="summary-card">
                                <h3>${bookings.filter(b => b.status === 'pending').length}</h3>
                                <p>Pending</p>
                            </div>
                            <div class="summary-card">
                                <h3>â‚¹${bookings.reduce((sum, booking) => sum + (booking.total_amount || 0), 0)}</h3>
                                <p>Total Revenue</p>
                            </div>
                        </div>
                        
                        <div class="bookings-filter">
                            <select class="filter-select" onchange="filterBookings('${tourId}', this.value)">
                                <option value="all">All Bookings</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="pending">Pending</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Participants</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    bookings.forEach(booking => {
                        let statusClass = '';
                        switch(booking.status) {
                            case 'confirmed':
                                statusClass = 'status-confirmed';
                                break;
                            case 'pending':
                                statusClass = 'status-pending';
                                break;
                            case 'cancelled':
                                statusClass = 'status-cancelled';
                                break;
                            case 'completed':
                                statusClass = 'status-completed';
                                break;
                        }
                        
                        bookingsHTML += `
                            <tr>
                                <td>${booking.id}</td>
                                <td>${booking.customer_name || 'Customer'}</td>
                                <td>${new Date(booking.tour_date).toLocaleDateString('en-IN')}</td>
                                <td>${booking.participants || 1}</td>
                                <td>â‚¹${booking.total_amount || tour.price}</td>
                                <td><span class="booking-status ${statusClass}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                            </tr>
                        `;
                    });
                    
                    bookingsHTML += `</tbody></table>`;
                    bookingsContent.innerHTML = bookingsHTML;
                }
                
                openModal('viewBookingsModal');
                
            } catch (error) {
                console.error('Error fetching bookings:', error);
                showNotification('Error loading bookings', 'error');
            }
        }
        
        // Filter Bookings
        async function filterBookings(tourId, status) {
            try {
                let query = supabase
                    .from('bookings')
                    .select('*')
                    .eq('tour_id', tourId);
                
                if (status !== 'all') {
                    query = query.eq('status', status);
                }
                
                query = query.order('created_at', { ascending: false });
                
                const { data: bookings, error } = await query;
                
                if (error) throw error;
                
                // Update bookings table
                const tbody = document.querySelector('#bookingsContent table tbody');
                tbody.innerHTML = '';
                
                bookings.forEach(booking => {
                    let statusClass = '';
                    switch(booking.status) {
                        case 'confirmed':
                            statusClass = 'status-confirmed';
                            break;
                        case 'pending':
                            statusClass = 'status-pending';
                            break;
                        case 'cancelled':
                            statusClass = 'status-cancelled';
                            break;
                        case 'completed':
                            statusClass = 'status-completed';
                            break;
                    }
                    
                    tbody.innerHTML += `
                        <tr>
                            <td>${booking.id}</td>
                            <td>${booking.customer_name || 'Customer'}</td>
                            <td>${new Date(booking.tour_date).toLocaleDateString('en-IN')}</td>
                            <td>${booking.participants || 1}</td>
                            <td>â‚¹${booking.total_amount || currentTour.price}</td>
                            <td><span class="booking-status ${statusClass}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
                        </tr>
                    `;
                });
                
            } catch (error) {
                console.error('Error filtering bookings:', error);
            }
        }
        
        // View Shipment Details
        async function viewShipmentDetails(productId) {
            try {
                const { data: product, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('id', productId)
                    .single();
                
                if (error) throw error;
                
                alert(`Shipment Details for ${product.name}:\n\nStatus: ${product.fulfillment_status}\n\nFor detailed tracking, please check with your courier service.`);
                
            } catch (error) {
                console.error('Error fetching shipment details:', error);
                showNotification('Error loading shipment details', 'error');
            }
        }
        
        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Show Notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            
            if (type === 'error') {
                notification.style.background = '#f44336';
                notification.querySelector('i').className = 'fas fa-exclamation-triangle';
            } else {
                notification.style.background = 'var(--primary)';
                notification.querySelector('i').className = 'fas fa-check-circle';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            loadDashboardData();
            loadProducts();
            loadTours();
            
            // Set current date for shipment
            document.getElementById('shipmentDate').valueAsDate = new Date();
            
            // Close modals when clicking outside
            window.onclick = function(event) {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            };
        });
    </script>
</body>
</html>
