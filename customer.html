<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmTrails - AgriTourism & Farmer Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "tu6s87m19d");
    </script>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --light: #F1F8E9;
            --dark: #1B5E20;
            --text: #212121;
            --accent: #8BC34A;
            --white: #ffffff;
            --gray-light: #f5f5f5;
            --gray: #757575;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gray-light);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 70px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--primary), var(--accent));
            color: var(--white);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .desktop-nav {
            display: none;
        }
        
        .desktop-nav-item {
            color: var(--white);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: var(--radius);
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            position: relative;
        }
        
        .desktop-nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .cart-icon {
            position: relative;
            cursor: pointer;
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--secondary);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--white);
            color: var(--white);
        }
        
        .btn-outline:hover {
            background: var(--white);
            color: var(--primary);
        }
        
        .btn-primary {
            background: var(--secondary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: #F57C00;
        }
        
        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                        url('https://images.unsplash.com/photo-1500937386664-56d1dfef3854?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&h=500&q=80') no-repeat center center/cover;
            color: var(--white);
            padding: 3rem 1rem;
            text-align: center;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .hero p {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .search-bar {
            display: flex;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .search-bar input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--radius) 0 0 var(--radius);
            font-size: 1rem;
        }
        
        .search-bar button {
            padding: 12px 20px;
            background: var(--secondary);
            color: var(--white);
            border: none;
            border-radius: 0 var(--radius) var(--radius) 0;
            cursor: pointer;
        }
        
        /* Section Styles */
        .section {
            padding: 2rem 1rem;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--dark);
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .tours, .products {
            background: var(--light);
        }
        
        /* Card Styles */
        .card-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .card:hover {
            transform: translateY(-3px);
        }
        
        .card-img {
            height: 140px;
            overflow: hidden;
        }
        
        .card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card-content {
            padding: 1rem;
        }
        
        .card h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .card p {
            color: var(--gray);
            margin-bottom: 0.8rem;
            font-size: 0.85rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-price {
            font-weight: bold;
            color: var(--secondary);
            font-size: 1rem;
            margin-bottom: 0.8rem;
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
        }
        
        .card-actions .btn {
            flex: 1;
            text-align: center;
            padding: 6px 10px;
            font-size: 0.8rem;
        }
        
        /* Out of Stock Styles */
        .out-of-stock {
            position: relative;
        }
        
        .out-of-stock::after {
            content: "Out of Stock";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .stock-low {
            color: #e74c3c;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        /* Features Section */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 1.5rem;
        }
        
        .feature-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-3px);
        }
        
        .feature-card i {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .feature-card h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            font-size: 0.7rem;
            transition: color 0.3s;
            flex: 1;
            position: relative;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        /* Cart Modal */
        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 400px;
            height: 100%;
            background: var(--white);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .cart-modal.open {
            display: block;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            background: var(--primary);
            color: var(--white);
        }
        
        .close-cart {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .cart-items {
            padding: 1rem;
        }
        
        .cart-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--radius);
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .cart-item-price {
            color: var(--secondary);
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        
        .quantity-btn {
            background: #eee;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .remove-item {
            color: #f44336;
            background: none;
            border: none;
            cursor: pointer;
            margin-left: auto;
        }
        
        .cart-total {
            padding: 1rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }
        
        .checkout-btn {
            display: block;
            width: calc(100% - 2rem);
            margin: 0 1rem 1rem;
            padding: 12px;
            background: var(--secondary);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
        }
        
        .empty-cart {
            padding: 2rem;
            text-align: center;
            color: var(--gray);
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .overlay.open {
            display: block;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: var(--white);
            padding: 2rem 1rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-section h3 {
            margin-bottom: 1rem;
        }
        
        .footer-section ul {
            list-style: none;
        }
        
        .footer-section ul li {
            margin-bottom: 0.5rem;
        }
        
        .footer-section a {
            color: #ddd;
            text-decoration: none;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 1rem;
        }
        
        .social-icons a {
            color: var(--white);
            font-size: 1.5rem;
        }
        
        .copyright {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            flex-direction: column;
            gap: 1rem;
            grid-column: 1 / -1;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* No Results Message */
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
            grid-column: 1 / -1;
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }
        
        /* Responsive Design */
        @media (min-width: 768px) {
            body {
                padding-bottom: 0;
            }
            
            .bottom-nav {
                display: none;
            }
            
            .desktop-nav {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .mobile-menu-btn {
                display: none;
            }
            
            .card-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
            
            .card-img {
                height: 180px;
            }
            
            .hero {
                padding: 4rem 1rem;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
            
            .section {
                padding: 3rem 1rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
        }
        
        @media (min-width: 1024px) {
            .card-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h1>FarmTrails</h1>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="header-right" id="headerRight">
                <!-- Desktop Navigation -->
                <nav class="desktop-nav">
                    <a href="#" class="desktop-nav-item active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#" class="desktop-nav-item">
                        <i class="fas fa-th-large"></i>
                        <span>Categories</span>
                    </a>
                    <a href="#" class="desktop-nav-item">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                    <div class="cart-icon" id="cartIcon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                </nav>
                
                <div class="profile">
                    <a href="index.html"><button class="btn btn-outline">Logout</button></a>
                </div>
            </div>
        </div>
    </header>

    <!-- Cart Modal -->
    <div class="overlay" id="overlay"></div>
    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="close-cart" id="closeCart">&times;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart" id="emptyCart">
                <i class="fas fa-shopping-cart fa-2x"></i>
                <p>Your cart is empty</p>
            </div>
        </div>
        <div class="cart-total" id="cartTotal" style="display: none;">
            <span>Total:</span>
            <span id="totalAmount">₹0</span>
        </div>
        <a href="payment.html" class="checkout-btn" id="checkoutBtn" style="display: none;">Proceed to Checkout</a>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h2>Experience Authentic Rural Life</h2>
            <p>Book farm tours directly with local farmers and buy fresh produce straight from the source</p>
            
            <div class="search-bar">
                <input type="text" id="globalSearch" placeholder="Search for farms, products or experiences...">
                <button onclick="searchProducts()"><i class="fas fa-search"></i> Search</button>
            </div>
        </div>
    </section>
    
    <!-- Tours Section -->
    <section class="section tours">
        <div class="container">
            <h2 class="section-title">Popular Farm Tours</h2>
            <div class="card-container" id="toursContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading tours...</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Products Section -->
    <section class="section products">
        <div class="container">
            <h2 class="section-title">Fresh From The Farm</h2>
            <div class="card-container" id="productsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading products...</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Features Section -->
    <section class="section">
        <div class="container">
            <h2 class="section-title">How It Works</h2>
            <div class="features">
                <div class="feature-card">
                    <i class="fas fa-search-location"></i>
                    <h3>Discover Farms</h3>
                    <p>Explore authentic farming experiences near you or at your travel destination</p>
                </div>
                
                <div class="feature-card">
                    <i class="fas fa-calendar-check"></i>
                    <h3>Book Tours</h3>
                    <p>Reserve your spot for farm visits, workshops, and agricultural experiences</p>
                </div>
                
                <div class="feature-card">
                    <i class="fas fa-shopping-basket"></i>
                    <h3>Buy Fresh Produce</h3>
                    <p>Purchase farm-fresh products directly from farmers without middlemen</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>FarmTrails</h3>
                    <p>Connecting tourists with local farmers for authentic agricultural experiences and fresh farm products.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Farm Tours</a></li>
                        <li><a href="#">Farm Products</a></li>
                        <li><a href="#">Become a Host</a></li>
                        <li><a href="#">About Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> 123 Farm Road, Agricultural District</li>
                        <li><i class="fas fa-phone"></i> +91 6309841404</li>
                        <li><i class="fas fa-envelope"></i> gchandavath@gmail.com</li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 FarmTrails. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-th-large"></i>
            <span>Category</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
        <a href="#" class="nav-item" id="bottomCartBtn">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
            <span class="cart-count" id="bottomCartCount">0</span>
        </a>
    </nav>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000/api'; // Use your actual backend API URL

        // API Service Class for Customer - REAL IMPLEMENTATION
        class CustomerAPIService {
            static async getProducts(category = null, search = null, limit = 20) {
                try {
                    let url = `${API_BASE_URL}/products?limit=${limit}`;
                    if (category) url += `&category=${category}`;
                    if (search) url += `&search=${encodeURIComponent(search)}`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.success) {
                        return data.products || [];
                    } else {
                        console.error('API Error:', data.error);
                        return [];
                    }
                } catch (error) {
                    console.error('Error fetching products:', error);
                    // Fallback to sample data if API fails
                    return this.getSampleProducts().filter(p => p.is_active);
                }
            }

            static async getTours(limit = 10) {
                try {
                    let url = `${API_BASE_URL}/tours?limit=${limit}`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.success) {
                        return data.tours || [];
                    } else {
                        console.error('API Error:', data.error);
                        return [];
                    }
                } catch (error) {
                    console.error('Error fetching tours:', error);
                    return this.getSampleTours();
                }
            }

            static async getProductById(productId) {
                try {
                    const response = await fetch(`${API_BASE_URL}/products/${productId}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        return data.product;
                    } else {
                        console.error('API Error:', data.error);
                        return null;
                    }
                } catch (error) {
                    console.error('Error fetching product:', error);
                    return null;
                }
            }

            // Keep sample data as fallback
            static getSampleProducts() {
                return [
                    {
                        _id: '1',
                        name: 'Organic Turmeric Powder',
                        description: 'Freshly harvested from our organic farm. Rich in curcumin with powerful anti-inflammatory effects.',
                        price: 350,
                        unit: '500gm',
                        images: ['https://images.unsplash.com/photo-1615485500834-bc10199bc727?q=80&w=880&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'],
                        category: 'spices',
                        stock: 45,
                        specifications: {
                            origin: 'Punjab, India',
                            shelf_life: '24 months',
                            storage: 'Cool, dry place'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Rajesh Kumar',
                            farm: 'Green Valley Organic Farm',
                            location: 'Punjab, India'
                        }
                    },
                    {
                        _id: '2',
                        name: 'Pure Forest Honey',
                        description: 'Raw, unfiltered honey collected from wildflowers in pristine forests.',
                        price: 450,
                        unit: '500gm',
                        images: ['https://images.unsplash.com/photo-1559715546-f66295d5aaa5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        category: 'dairy',
                        stock: 32,
                        specifications: {
                            origin: 'Himachal Pradesh, India',
                            shelf_life: '18 months',
                            storage: 'Room temperature'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Sunita Devi',
                            farm: 'Sunny Bee Farms',
                            location: 'Himachal Pradesh, India'
                        }
                    },
                    {
                        _id: '3',
                        name: 'Natural Jaggery',
                        description: '100% natural jaggery from farms. Made from organic sugarcane juice without any chemical processing.',
                        price: 300,
                        unit: 'kg',
                        images: ['https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Sa-indian-gud.jpg/800px-Sa-indian-gud.jpg'],
                        category: 'sweets',
                        stock: 28,
                        specifications: {
                            origin: 'Maharashtra, India',
                            shelf_life: '12 months',
                            storage: 'Airtight container'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Vikram Singh',
                            farm: 'Sweet Cane Organics',
                            location: 'Maharashtra, India'
                        }
                    },
                    {
                        _id: '4',
                        name: 'Organic Tomatoes',
                        description: 'Fresh, pesticide-free tomatoes grown in our organic farms. Rich in lycopene and vitamin C.',
                        price: 80,
                        unit: 'kg',
                        images: ['https://images.unsplash.com/photo-1546470427-e212b7d310ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400&q=80'],
                        category: 'vegetables',
                        stock: 15,
                        specifications: {
                            origin: 'Karnataka, India',
                            shelf_life: '7 days',
                            storage: 'Refrigerate'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Anil Reddy',
                            farm: 'Red Earth Farms',
                            location: 'Karnataka, India'
                        }
                    },
                    {
                        _id: '5',
                        name: 'Fresh Cow Milk',
                        description: 'Pure farm fresh milk from grass-fed cows. Collected daily and minimally processed.',
                        price: 60,
                        unit: 'liter',
                        images: ['https://images.unsplash.com/photo-1563636619-e9143da7973b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400&q=80'],
                        category: 'dairy',
                        stock: 20,
                        specifications: {
                            origin: 'Uttar Pradesh, India',
                            shelf_life: '3 days',
                            storage: 'Refrigerate'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Gopal Yadav',
                            farm: 'Happy Cow Dairy',
                            location: 'Uttar Pradesh, India'
                        }
                    },
                    {
                        _id: '6',
                        name: 'Farm Eggs',
                        description: 'Free-range organic eggs from happy, healthy chickens.',
                        price: 120,
                        unit: 'dozen',
                        images: ['https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400&q=80'],
                        category: 'poultry',
                        stock: 0, // Out of stock
                        specifications: {
                            origin: 'Local Farm',
                            shelf_life: '3 weeks',
                            storage: 'Refrigerate'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Local Poultry Farm',
                            farm: 'Happy Hens Farm',
                            location: 'Local'
                        }
                    }
                ];
            }

            static getSampleTours() {
                return [
                    {
                        _id: 'tour1',
                        name: 'Organic Vegetable Farm Tour',
                        description: 'Join us for a guided tour of our organic farm and learn about sustainable farming practices.',
                        price: 499,
                        images: ['https://images.unsplash.com/photo-1520052203542-d3095f1b6cf0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '2 hours',
                        capacity: '15 people',
                        category: 'farm_tour',
                        includes: ['Guided farm tour', 'Vegetable picking', 'Organic lunch', 'Take-home produce'],
                        farmer: {
                            name: 'Rajesh Kumar',
                            farm: 'Green Valley Organic Farm'
                        },
                        is_active: true
                    },
                    {
                        _id: 'tour2',
                        name: 'Dairy Farm Experience',
                        description: 'Experience a day in the life of a dairy farmer with milking sessions and butter making.',
                        price: 699,
                        images: ['https://images.unsplash.com/photo-1570042225831-d98fa7577f1e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '3 hours',
                        capacity: '10 people',
                        category: 'experience',
                        includes: ['Milking session', 'Butter making', 'Farm fresh dairy products'],
                        farmer: {
                            name: 'Gopal Yadav',
                            farm: 'Happy Cow Dairy'
                        },
                        is_active: true
                    },
                    {
                        _id: 'tour3',
                        name: 'Vineyard & Wine Tasting',
                        description: 'Tour through beautiful vineyards and learn about wine production with tasting sessions.',
                        price: 899,
                        images: ['https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '4 hours',
                        capacity: '12 people',
                        category: 'experience',
                        includes: ['Vineyard tour', 'Wine tasting', 'Cheese pairing'],
                        farmer: {
                            name: 'Vineyard Estates',
                            farm: 'Sunrise Vineyards'
                        },
                        is_active: true
                    },
                    {
                        _id: 'tour4',
                        name: 'Seasonal Fruit Picking',
                        description: 'Pick your own seasonal fruits straight from the orchard and learn about fruit cultivation.',
                        price: 399,
                        images: ['https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '2 hours',
                        capacity: '20 people',
                        category: 'farm_tour',
                        includes: ['Orchard tour', 'Fruit picking', 'Take-home fruits'],
                        farmer: {
                            name: 'Local Orchard',
                            farm: 'Sunny Fruit Farms'
                        },
                        is_active: true
                    }
                ];
            }
        }

        // Global variables
        let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
        let allProducts = [];
        let allTours = [];
        let currentSearchState = {
            isSearching: false,
            searchTerm: '',
            searchResults: {
                products: [],
                tours: []
            }
        };

        // Cart functionality
        const cartIcon = document.getElementById('cartIcon');
        const cartModal = document.getElementById('cartModal');
        const overlay = document.getElementById('overlay');
        const closeCart = document.getElementById('closeCart');
        const cartItemsContainer = document.getElementById('cartItems');
        const emptyCart = document.getElementById('emptyCart');
        const cartCount = document.getElementById('cartCount');
        const cartTotal = document.getElementById('cartTotal');
        const totalAmount = document.getElementById('totalAmount');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const bottomCartBtn = document.getElementById('bottomCartBtn');
        const bottomCartCount = document.getElementById('bottomCartCount');
        
        // Open cart
        if (cartIcon) {
            cartIcon.addEventListener('click', openCart);
        }
        bottomCartBtn.addEventListener('click', openCart);
        
        function openCart() {
            cartModal.classList.add('open');
            overlay.classList.add('open');
            document.body.style.overflow = 'hidden';
        }
        
        // Close cart
        closeCart.addEventListener('click', closeCartModal);
        overlay.addEventListener('click', closeCartModal);
        
        function closeCartModal() {
            cartModal.classList.remove('open');
            overlay.classList.remove('open');
            document.body.style.overflow = 'auto';
        }
        
        // Add to cart function
        function addToCart(name, price, image, productId = null, type = 'product') {
            // Check if item already exists in cart
            const existingItemIndex = cartItems.findIndex(item => 
                item.name === name && item.type === type
            );
            
            if (existingItemIndex !== -1) {
                // Item exists, increase quantity
                cartItems[existingItemIndex].quantity += 1;
            } else {
                // Item doesn't exist, add new item
                cartItems.push({
                    name,
                    price,
                    image,
                    productId,
                    type,
                    quantity: 1
                });
            }
            
            updateCart();
            saveCartToLocalStorage();
            
            // Show notification
            showNotification(`${name} added to cart!`);
            
            // Open cart automatically on desktop, but not on mobile
            if (window.innerWidth > 768) {
                openCart();
            }
        }
        
        // Update cart UI
        function updateCart() {
            // Update cart count
            const totalItems = cartItems.reduce((total, item) => total + item.quantity, 0);
            
            // Update cart count in header (desktop)
            if (cartCount) {
                cartCount.textContent = totalItems;
            }
            
            // Update cart count in bottom nav (mobile)
            if (bottomCartCount) {
                bottomCartCount.textContent = totalItems;
                if (totalItems > 0) {
                    bottomCartCount.style.display = 'flex';
                } else {
                    bottomCartCount.style.display = 'none';
                }
            }
            
            // Clear cart items container
            cartItemsContainer.innerHTML = '';
            
            if (cartItems.length === 0) {
                // Show empty cart message
                emptyCart.style.display = 'block';
                cartTotal.style.display = 'none';
                checkoutBtn.style.display = 'none';
            } else {
                // Hide empty cart message
                emptyCart.style.display = 'none';
                
                // Add items to cart
                let total = 0;
                
                cartItems.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    cartItemElement.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="cart-item-img">
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">₹${item.price}</div>
                            <div class="cart-item-type" style="font-size: 0.8rem; color: var(--gray);">${item.type === 'tour' ? 'Tour' : 'Product'}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="changeQuantity(${index}, -1)">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">+</button>
                            </div>
                        </div>
                        <button class="remove-item" onclick="removeItem(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    cartItemsContainer.appendChild(cartItemElement);
                });
                
                // Update total
                totalAmount.textContent = `₹${total}`;
                cartTotal.style.display = 'flex';
                checkoutBtn.style.display = 'block';
                
                // Update checkout button with cart data
                const cartData = encodeURIComponent(JSON.stringify(cartItems));
                checkoutBtn.href = `payment.html?cart=${cartData}&total=${total}`;
            }
        }
        
        // Change item quantity
        function changeQuantity(index, change) {
            cartItems[index].quantity += change;
            
            // Remove item if quantity is 0
            if (cartItems[index].quantity <= 0) {
                cartItems.splice(index, 1);
            }
            
            updateCart();
            saveCartToLocalStorage();
        }
        
        // Remove item from cart
        function removeItem(index) {
            cartItems.splice(index, 1);
            updateCart();
            saveCartToLocalStorage();
        }
        
        // Save cart to localStorage
        function saveCartToLocalStorage() {
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
        }
        
        // Show notification
        function showNotification(message, duration = 3000) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.bottom = '80px';
            notification.style.right = '20px';
            notification.style.backgroundColor = 'var(--primary)';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = 'var(--radius)';
            notification.style.zIndex = '1000';
            notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            notification.style.fontSize = '0.9rem';
            notification.style.maxWidth = '300px';
            notification.style.wordWrap = 'break-word';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, duration);
        }

        // Load products from MongoDB
        // Load products from MongoDB
async function loadProducts() {
    try {
        const productsContainer = document.getElementById('productsContainer');
        productsContainer.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading fresh products...</p>
            </div>
        `;

        const products = await CustomerAPIService.getProducts();
        allProducts = products; // Make sure this line exists
        displayProducts(products);
    } catch (error) {
        console.error('Error loading products:', error);
        const productsContainer = document.getElementById('productsContainer');
        productsContainer.innerHTML = `
            <div class="no-results">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Products</h3>
                <p>Failed to load products. Please try again later.</p>
            </div>
        `;
    }
}

// Load tours from MongoDB
async function loadTours() {
    try {
        const toursContainer = document.getElementById('toursContainer');
        toursContainer.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading farm tours...</p>
            </div>
        `;

        const tours = await CustomerAPIService.getTours();
        allTours = tours; // Make sure this line exists
        displayTours(tours);
    } catch (error) {
        console.error('Error loading tours:', error);
        const toursContainer = document.getElementById('toursContainer');
        toursContainer.innerHTML = `
            <div class="no-results">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Tours</h3>
                <p>Failed to load tours. Please try again later.</p>
            </div>
        `;
    }
}
        
        // Display products
        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-seedling"></i>
                        <h3>No Products Available</h3>
                        <p>Check back later for fresh farm products!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = products.map(product => {
                const isOutOfStock = product.stock === 0;
                const isLowStock = product.stock > 0 && product.stock < 10;
                const cardClass = isOutOfStock ? 'card out-of-stock' : 'card';
                
                return `
                <div class="${cardClass}" onclick="${!isOutOfStock ? `window.location.href='product-details.html?id=${product._id}'` : ''}">
                    <div class="card-img">
                        <img src="${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/300x200?text=Product+Image'}" 
                             alt="${product.name}" 
                             onerror="this.src='https://via.placeholder.com/300x200?text=Product+Image'">
                    </div>
                    <div class="card-content">
                        <h3>${product.name}</h3>
                        <p>${product.description.substring(0, 100)}...</p>
                        <div class="card-price">₹${product.price} / ${product.unit}</div>
                        ${isLowStock ? `<div class="stock-low">Only ${product.stock} left in stock!</div>` : ''}
                        <div class="card-actions">
                            <button class="btn btn-outline" onclick="event.stopPropagation(); window.location.href='product-details.html?id=${product._id}'">Details</button>
                            <button class="btn btn-primary" 
                                    onclick="event.stopPropagation(); addToCart('${product.name}', ${product.price}, '${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/300x200?text=Product+Image'}', '${product._id}', 'product')" 
                                    ${isOutOfStock ? 'disabled' : ''}>
                                ${isOutOfStock ? 'Out of Stock' : 'Add to Cart'}
                            </button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // Display tours
        function displayTours(tours) {
            const container = document.getElementById('toursContainer');
            
            if (!tours || tours.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-map-marked-alt"></i>
                        <h3>No Tours Available</h3>
                        <p>Check back later for exciting farm tours!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = tours.map(tour => `
                <div class="card" onclick="window.location.href='product-details.html?id=${tour._id}'">
                    <div class="card-img">
                        <img src="${tour.images && tour.images.length > 0 ? tour.images[0] : 'https://via.placeholder.com/300x200?text=Tour+Image'}" 
                             alt="${tour.name}"
                             onerror="this.src='https://via.placeholder.com/300x200?text=Tour+Image'">
                    </div>
                    <div class="card-content">
                        <h3>${tour.name}</h3>
                        <p>${tour.description.substring(0, 100)}...</p>
                        <div class="card-price">₹${tour.price} / person</div>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 0.8rem;">
                            <i class="fas fa-clock"></i> ${tour.duration} • 
                            <i class="fas fa-users"></i> ${tour.capacity}
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-outline" onclick="event.stopPropagation(); window.location.href='product-details.html?id=${tour._id}'">Details</button>
                            <button class="btn btn-primary" onclick="event.stopPropagation(); addToCart('${tour.name}', ${tour.price}, '${tour.images && tour.images.length > 0 ? tour.images[0] : 'https://via.placeholder.com/300x200?text=Tour+Image'}', '${tour._id}', 'tour')">
                                Book Now
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        // Search products and tours
async function searchProducts() {
    const searchTerm = document.getElementById('globalSearch').value.trim();
    
    if (!searchTerm) {
        // If search is empty, reload all products and tours
        currentSearchState.isSearching = false;
        currentSearchState.searchTerm = '';
        await loadProducts();
        await loadTours();
        return;
    }

    try {
        // Show loading state for both sections
        const productsContainer = document.getElementById('productsContainer');
        const toursContainer = document.getElementById('toursContainer');
        
        productsContainer.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p>Searching products...</p>
            </div>
        `;
        
        toursContainer.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p>Searching tours...</p>
            </div>
        `;

        // Use client-side filtering
        const filteredProducts = allProducts.filter(product => 
            product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
            product.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
            (product.category && product.category.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (product.farmer && product.farmer.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (product.farmer && product.farmer.farm.toLowerCase().includes(searchTerm.toLowerCase()))
        );

        const filteredTours = allTours.filter(tour => 
            tour.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
            tour.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
            (tour.farmer && tour.farmer.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (tour.farmer && tour.farmer.farm.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (tour.includes && tour.includes.some(item => 
                item.toLowerCase().includes(searchTerm.toLowerCase())
            ))
        );

        // Update search state
        currentSearchState = {
            isSearching: true,
            searchTerm: searchTerm,
            searchResults: {
                products: filteredProducts,
                tours: filteredTours
            }
        };

        // Display results
        displayProducts(filteredProducts);
        displayTours(filteredTours);

        // Show search results summary
        showSearchResultsSummary(filteredProducts.length, filteredTours.length, searchTerm);

    } catch (error) {
        console.error('Error searching:', error);
        showNotification('Error performing search');
    }
}

// Enhanced refresh function that preserves search state
async function refreshWithSearchPreservation() {
    const searchTerm = document.getElementById('globalSearch').value.trim();
    
    if (currentSearchState.isSearching && searchTerm) {
        // We're in search mode - refresh the search with latest data
        console.log('Refreshing search results for:', searchTerm);
        
        try {
            // Get fresh data from API
            const freshProducts = await CustomerAPIService.getProducts();
            const freshTours = await CustomerAPIService.getTours();
            
            // Update global arrays with fresh data
            allProducts = freshProducts;
            allTours = freshTours;
            
            // Re-apply the current search to fresh data
            const filteredProducts = freshProducts.filter(product => 
                product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (product.category && product.category.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (product.farmer && product.farmer.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (product.farmer && product.farmer.farm.toLowerCase().includes(searchTerm.toLowerCase()))
            );
            
            const filteredTours = freshTours.filter(tour => 
                tour.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                tour.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (tour.farmer && tour.farmer.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (tour.farmer && tour.farmer.farm.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (tour.includes && tour.includes.some(item => 
                    item.toLowerCase().includes(searchTerm.toLowerCase())
                ))
            );
            
            // Update current search state with fresh results
            currentSearchState.searchResults = {
                products: filteredProducts,
                tours: filteredTours
            };
            
            // Display refreshed results
            displayProducts(filteredProducts);
            displayTours(filteredTours);
            
            // Update search summary
            showSearchResultsSummary(filteredProducts.length, filteredTours.length, searchTerm);
            
            // Show subtle notification that results were updated
            showNotification('Search results updated with latest data', 2000);
            
        } catch (error) {
            console.error('Error refreshing search results:', error);
            // If refresh fails, keep showing current results
            showNotification('Failed to update search results', 2000);
        }
    } else {
        // Not in search mode - normal refresh
        console.log('Refreshing all products and tours...');
        await loadProducts();
        await loadTours();
    }
}

// Enhanced clear search function
function clearSearch() {
    document.getElementById('globalSearch').value = '';
    
    // Remove search summary
    const searchSummary = document.getElementById('searchResultsSummary');
    if (searchSummary) {
        searchSummary.remove();
    }
    
    // Reset section titles
    const productsTitle = document.querySelector('.products .section-title');
    const toursTitle = document.querySelector('.tours .section-title');
    
    if (productsTitle) {
        productsTitle.textContent = 'Fresh From The Farm';
    }
    if (toursTitle) {
        toursTitle.textContent = 'Popular Farm Tours';
    }
    
    // Clear search state
    currentSearchState.isSearching = false;
    currentSearchState.searchTerm = '';
    currentSearchState.searchResults = { products: [], tours: [] };
    
    // Reload all content
    loadProducts();
    loadTours();
}

// Enhanced showSearchResultsSummary function
function showSearchResultsSummary(productsCount, toursCount, searchTerm) {
    // Remove any existing search summary
    const existingSummary = document.getElementById('searchResultsSummary');
    if (existingSummary) {
        existingSummary.remove();
    }

    if (productsCount === 0 && toursCount === 0 && searchTerm) {
        // Create and show "no results" message
        const searchSummary = document.createElement('div');
        searchSummary.id = 'searchResultsSummary';
        searchSummary.style.cssText = `
            text-align: center;
            padding: 2rem;
            background: var(--white);
            margin: 1rem auto;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 600px;
        `;
        searchSummary.innerHTML = `
            <i class="fas fa-search fa-3x" style="color: var(--gray); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--dark); margin-bottom: 0.5rem;">No results found for "${searchTerm}"</h3>
            <p style="color: var(--gray);">Try adjusting your search terms or browse all categories.</p>
            <div style="margin-top: 1rem;">
                <button class="btn btn-primary" onclick="clearSearch()">
                    <i class="fas fa-times"></i> Clear Search
                </button>
                <button class="btn btn-outline" onclick="loadProducts(); loadTours();" style="margin-left: 0.5rem;">
                    <i class="fas fa-sync"></i> Show All
                </button>
            </div>
        `;
        
        // Insert after hero section
        const heroSection = document.querySelector('.hero');
        heroSection.parentNode.insertBefore(searchSummary, heroSection.nextSibling);
    } else if (searchTerm) {
        // Create and show results summary with refresh info
        const searchSummary = document.createElement('div');
        searchSummary.id = 'searchResultsSummary';
        searchSummary.style.cssText = `
            text-align: center;
            padding: 1rem;
            background: var(--light);
            margin: 1rem auto;
            border-radius: var(--radius);
            max-width: 700px;
            font-size: 0.9rem;
            color: var(--dark);
            border-left: 4px solid var(--primary);
        `;
        searchSummary.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <div style="text-align: left;">
                    <strong>${productsCount + toursCount} results</strong> found for "${searchTerm}" 
                    <br><small style="color: var(--gray);">(${productsCount} products, ${toursCount} tours) • Auto-updates every 30 seconds</small>
                </div>
                <div>
                    <button class="btn btn-outline" onclick="clearSearch()" style="padding: 4px 8px; font-size: 0.8rem; margin-right: 0.5rem;">
                        <i class="fas fa-times"></i> Clear
                    </button>
                    <button class="btn btn-outline" onclick="refreshWithSearchPreservation()" style="padding: 4px 8px; font-size: 0.8rem;">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
        `;
        
        // Insert after hero section
        const heroSection = document.querySelector('.hero');
        heroSection.parentNode.insertBefore(searchSummary, heroSection.nextSibling);
        
        // Update section titles to show search context
        updateSectionTitlesForSearch(searchTerm);
    }
}

// Update section titles during search
function updateSectionTitlesForSearch(searchTerm) {
    const productsTitle = document.querySelector('.products .section-title');
    const toursTitle = document.querySelector('.tours .section-title');
    
    if (productsTitle) {
        productsTitle.innerHTML = `Products matching "${searchTerm}"`;
    }
    if (toursTitle) {
        toursTitle.innerHTML = `Tours matching "${searchTerm}"`;
    }
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(e) {
    const headerRight = document.getElementById('headerRight');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    
    if (headerRight && mobileMenuBtn && !headerRight.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
        headerRight.classList.remove('mobile-open');
    }
});

        // Desktop navigation functionality
        document.querySelectorAll('.desktop-nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (!this.querySelector('.fa-shopping-cart')) {
                    e.preventDefault();
                    document.querySelectorAll('.desktop-nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    const text = this.querySelector('span').textContent;
                    if (text === 'Home') {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else if (text === 'Categories') {
                        // Show categories page
                        showNotification('Categories page would open here');
                    } else if (text === 'Profile') {
                        window.location.href = 'profile.html';
                    }
                }
            });
        });

        // Mobile menu functionality
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const headerRight = document.getElementById('headerRight');
            headerRight.classList.toggle('mobile-open');
        });
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load products and tours
            loadProducts();
            loadTours();
            
            // Initialize cart
            updateCart();
            
            // Add event listener for Enter key in search
            document.getElementById('globalSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProducts();
                }
            });
            
            // Auto-refresh products every 30 seconds to get latest from farmers
            setInterval(async () => {
                console.log('Refreshing products for latest updates...');
                await loadProducts();
                await loadTours();
            }, 1800000); // 30 minutes (30*60*1000 = 1,800,000 ms)
        });
        // Add event listener for Enter key in search
document.getElementById('globalSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchProducts();
    }
});

// Add real-time search as user types (optional)
let searchTimeout;
document.getElementById('globalSearch').addEventListener('input', function(e) {
    clearTimeout(searchTimeout);
    const searchTerm = e.target.value.trim();
    
    if (searchTerm.length === 0) {
        clearSearch();
        return;
    }
    
    if (searchTerm.length >= 2) { // Only search after 2 characters
        searchTimeout = setTimeout(() => {
            searchProducts();
        }, 500); // 500ms delay
    }
});
    </script>
</body>
</html>
