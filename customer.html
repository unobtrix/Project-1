<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmTrails - AgriTourism & Farmer Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --light: #F1F8E9;
            --dark: #1B5E20;
            --text: #212121;
            --accent: #8BC34A;
            --white: #ffffff;
            --gray-light: #f5f5f5;
            --gray: #757575;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gray-light);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 70px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--primary), var(--accent));
            color: var(--white);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .desktop-nav {
            display: none;
        }
        
        .desktop-nav-item {
            color: var(--white);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: var(--radius);
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            position: relative;
        }
        
        .desktop-nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .cart-icon {
            position: relative;
            cursor: pointer;
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--secondary);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--white);
            color: var(--white);
        }
        
        .btn-outline:hover {
            background: var(--white);
            color: var(--primary);
        }
        
        .btn-primary {
            background: var(--secondary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: #F57C00;
        }
        
        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                        url('https://images.unsplash.com/photo-1500937386664-56d1dfef3854?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&h=500&q=80') no-repeat center center/cover;
            color: var(--white);
            padding: 3rem 1rem;
            text-align: center;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .hero p {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .search-bar {
            display: flex;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .search-bar input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--radius) 0 0 var(--radius);
            font-size: 1rem;
        }
        
        .search-bar button {
            padding: 12px 20px;
            background: var(--secondary);
            color: var(--white);
            border: none;
            border-radius: 0 var(--radius) var(--radius) 0;
            cursor: pointer;
        }
        
        /* Section Styles */
        .section {
            padding: 2rem 1rem;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--dark);
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .tours, .products {
            background: var(--light);
        }
        
        /* Card Styles */
        .card-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .card:hover {
            transform: translateY(-3px);
        }
        
        .card-img {
            height: 140px;
            overflow: hidden;
        }
        
        .card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card-content {
            padding: 1rem;
        }
        
        .card h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .card p {
            color: var(--gray);
            margin-bottom: 0.8rem;
            font-size: 0.85rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-price {
            font-weight: bold;
            color: var(--secondary);
            font-size: 1rem;
            margin-bottom: 0.8rem;
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
        }
        
        .card-actions .btn {
            flex: 1;
            text-align: center;
            padding: 6px 10px;
            font-size: 0.8rem;
        }
        
        /* Out of Stock Styles */
        .out-of-stock {
            position: relative;
        }
        
        .out-of-stock::after {
            content: "Out of Stock";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .stock-low {
            color: #e74c3c;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        /* Features Section */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 1.5rem;
        }
        
        .feature-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-3px);
        }
        
        .feature-card i {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .feature-card h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            font-size: 0.7rem;
            transition: color 0.3s;
            flex: 1;
            position: relative;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        /* Cart Modal */
        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 400px;
            height: 100%;
            background: var(--white);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .cart-modal.open {
            display: block;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            background: var(--primary);
            color: var(--white);
        }
        
        .close-cart {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .cart-items {
            padding: 1rem;
        }
        
        .cart-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--radius);
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .cart-item-price {
            color: var(--secondary);
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        
        .quantity-btn {
            background: #eee;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .remove-item {
            color: #f44336;
            background: none;
            border: none;
            cursor: pointer;
            margin-left: auto;
        }
        
        .cart-total {
            padding: 1rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }
        
        .checkout-btn {
            display: block;
            width: calc(100% - 2rem);
            margin: 0 1rem 1rem;
            padding: 12px;
            background: var(--secondary);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
        }
        
        .empty-cart {
            padding: 2rem;
            text-align: center;
            color: var(--gray);
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .overlay.open {
            display: block;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: var(--white);
            padding: 2rem 1rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-section h3 {
            margin-bottom: 1rem;
        }
        
        .footer-section ul {
            list-style: none;
        }
        
        .footer-section ul li {
            margin-bottom: 0.5rem;
        }
        
        .footer-section a {
            color: #ddd;
            text-decoration: none;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 1rem;
        }
        
        .social-icons a {
            color: var(--white);
            font-size: 1.5rem;
        }
        
        .copyright {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            flex-direction: column;
            gap: 1rem;
            grid-column: 1 / -1;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* No Results Message */
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
            grid-column: 1 / -1;
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }
        
        /* Offline Mode Indicator */
        .offline-indicator {
            background: #ff9800;
            color: white;
            padding: 8px 16px;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 70px;
            z-index: 99;
        }
        
        /* Responsive Design */
        @media (min-width: 768px) {
            body {
                padding-bottom: 0;
            }
            
            .bottom-nav {
                display: none;
            }
            
            .desktop-nav {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .mobile-menu-btn {
                display: none;
            }
            
            .card-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
            
            .card-img {
                height: 180px;
            }
            
            .hero {
                padding: 4rem 1rem;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
            
            .section {
                padding: 3rem 1rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
        }
        
        @media (min-width: 1024px) {
            .card-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h1>FarmTrails</h1>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="header-right" id="headerRight">
                <!-- Desktop Navigation -->
                <nav class="desktop-nav">
                    <a href="#" class="desktop-nav-item active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#" class="desktop-nav-item">
                        <i class="fas fa-th-large"></i>
                        <span>Categories</span>
                    </a>
                    <a href="#" class="desktop-nav-item">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                    <div class="cart-icon" id="cartIcon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                </nav>
                
                <div class="profile">
                    <a href="farmerpage.html"><button class="btn btn-outline">Farmer Login</button></a>
                </div>
            </div>
        </div>
    </header>

    <!-- Offline Mode Indicator -->
    <div class="offline-indicator" id="offlineIndicator" style="display: none;">
        <i class="fas fa-wifi"></i> You're viewing demo content. Some features may be limited.
    </div>

    <!-- Cart Modal -->
    <div class="overlay" id="overlay"></div>
    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="close-cart" id="closeCart">&times;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart" id="emptyCart">
                <i class="fas fa-shopping-cart fa-2x"></i>
                <p>Your cart is empty</p>
            </div>
        </div>
        <div class="cart-total" id="cartTotal" style="display: none;">
            <span>Total:</span>
            <span id="totalAmount">₹0</span>
        </div>
        <a href="#" class="checkout-btn" id="checkoutBtn" style="display: none;" onclick="handleCheckout()">Proceed to Checkout</a>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h2>Experience Authentic Rural Life</h2>
            <p>Book farm tours directly with local farmers and buy fresh produce straight from the source</p>
            
            <div class="search-bar">
                <input type="text" id="globalSearch" placeholder="Search for farms, products or experiences...">
                <button onclick="searchProducts()"><i class="fas fa-search"></i> Search</button>
            </div>
        </div>
    </section>
    
    <!-- Tours Section -->
    <section class="section tours">
        <div class="container">
            <h2 class="section-title">Popular Farm Tours</h2>
            <div class="card-container" id="toursContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading tours...</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Products Section -->
    <section class="section products">
        <div class="container">
            <h2 class="section-title">Fresh From The Farm</h2>
            <div class="card-container" id="productsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading products...</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Features Section -->
    <section class="section">
        <div class="container">
            <h2 class="section-title">How It Works</h2>
            <div class="features">
                <div class="feature-card">
                    <i class="fas fa-search-location"></i>
                    <h3>Discover Farms</h3>
                    <p>Explore authentic farming experiences near you or at your travel destination</p>
                </div>
                
                <div class="feature-card">
                    <i class="fas fa-calendar-check"></i>
                    <h3>Book Tours</h3>
                    <p>Reserve your spot for farm visits, workshops, and agricultural experiences</p>
                </div>
                
                <div class="feature-card">
                    <i class="fas fa-shopping-basket"></i>
                    <h3>Buy Fresh Produce</h3>
                    <p>Purchase farm-fresh products directly from farmers without middlemen</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>FarmTrails</h3>
                    <p>Connecting tourists with local farmers for authentic agricultural experiences and fresh farm products.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Farm Tours</a></li>
                        <li><a href="#">Farm Products</a></li>
                        <li><a href="#">Become a Host</a></li>
                        <li><a href="#">About Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> 123 Farm Road, Agricultural District</li>
                        <li><i class="fas fa-phone"></i> +91 6309841404</li>
                        <li><i class="fas fa-envelope"></i> gchandavath@gmail.com</li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 FarmTrails. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-th-large"></i>
            <span>Category</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
        <a href="#" class="nav-item" id="bottomCartBtn">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
            <span class="cart-count" id="bottomCartCount">0</span>
        </a>
    </nav>

    <script>
        // Enhanced Customer API Service with better error handling
        class CustomerAPIService {
            constructor() {
                this.baseURL = '';
                this.useDemoData = false;
                this.timeout = 5000; // 5 second timeout
            }

            async fetchWithTimeout(resource, options = {}) {
                const controller = new AbortController();
                const id = setTimeout(() => controller.abort(), this.timeout);
                
                try {
                    const response = await fetch(resource, {
                        ...options,
                        signal: controller.signal
                    });
                    clearTimeout(id);
                    return response;
                } catch (error) {
                    clearTimeout(id);
                    throw error;
                }
            }

            // Get all products with fallback to demo data
            async getProducts() {
                // First try Netlify function
                try {
                    console.log('Attempting to fetch products from Netlify function...');
                    const response = await this.fetchWithTimeout('/.netlify/functions/get-all-products');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('Successfully fetched products from API:', data);
                    
                    if (data.products && Array.isArray(data.products)) {
                        this.useDemoData = false;
                        return data.products;
                    } else {
                        throw new Error('Invalid data format from API');
                    }
                } catch (error) {
                    console.warn('API fetch failed, using demo data:', error.message);
                    this.useDemoData = true;
                    return this.getDemoProducts();
                }
            }

            // Get all tours with fallback to demo data
            async getTours() {
                // First try Netlify function
                try {
                    console.log('Attempting to fetch tours from Netlify function...');
                    const response = await this.fetchWithTimeout('/.netlify/functions/get-all-tours');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('Successfully fetched tours from API:', data);
                    
                    if (data.tours && Array.isArray(data.tours)) {
                        this.useDemoData = false;
                        return data.tours;
                    } else {
                        throw new Error('Invalid data format from API');
                    }
                } catch (error) {
                    console.warn('API fetch failed, using demo data:', error.message);
                    this.useDemoData = true;
                    return this.getDemoTours();
                }
            }

            // Demo data as fallback
            getDemoProducts() {
                return [
                    {
                        _id: '1',
                        name: 'Organic Turmeric Powder',
                        description: 'Freshly harvested from our organic farm. Rich in curcumin with powerful anti-inflammatory effects.',
                        price: 350,
                        unit: '500gm',
                        images: ['https://images.unsplash.com/photo-1615485500834-bc10199bc727?q=80&w=880&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'],
                        category: 'spices',
                        stock: 45,
                        specifications: {
                            origin: 'Punjab, India',
                            shelf_life: '24 months',
                            storage: 'Cool, dry place'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Rajesh Kumar',
                            farm: 'Green Valley Organic Farm',
                            location: 'Punjab, India'
                        }
                    },
                    {
                        _id: '2',
                        name: 'Pure Forest Honey',
                        description: 'Raw, unfiltered honey collected from wildflowers in pristine forests.',
                        price: 450,
                        unit: '500gm',
                        images: ['https://images.unsplash.com/photo-1559715546-f66295d5aaa5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        category: 'dairy',
                        stock: 32,
                        specifications: {
                            origin: 'Himachal Pradesh, India',
                            shelf_life: '18 months',
                            storage: 'Room temperature'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Sunita Devi',
                            farm: 'Sunny Bee Farms',
                            location: 'Himachal Pradesh, India'
                        }
                    },
                    {
                        _id: '3',
                        name: 'Natural Jaggery',
                        description: '100% natural jaggery from farms. Made from organic sugarcane juice without any chemical processing.',
                        price: 300,
                        unit: 'kg',
                        images: ['https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Sa-indian-gud.jpg/800px-Sa-indian-gud.jpg'],
                        category: 'sweets',
                        stock: 28,
                        specifications: {
                            origin: 'Maharashtra, India',
                            shelf_life: '12 months',
                            storage: 'Airtight container'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Vikram Singh',
                            farm: 'Sweet Cane Organics',
                            location: 'Maharashtra, India'
                        }
                    },
                    {
                        _id: '4',
                        name: 'Organic Tomatoes',
                        description: 'Fresh, pesticide-free tomatoes grown in our organic farms. Rich in lycopene and vitamin C.',
                        price: 80,
                        unit: 'kg',
                        images: ['https://images.unsplash.com/photo-1546470427-e212b7d310ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400&q=80'],
                        category: 'vegetables',
                        stock: 15,
                        specifications: {
                            origin: 'Karnataka, India',
                            shelf_life: '7 days',
                            storage: 'Refrigerate'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Anil Reddy',
                            farm: 'Red Earth Farms',
                            location: 'Karnataka, India'
                        }
                    },
                    {
                        _id: '5',
                        name: 'Fresh Cow Milk',
                        description: 'Pure farm fresh milk from grass-fed cows. Collected daily and minimally processed.',
                        price: 60,
                        unit: 'liter',
                        images: ['https://images.unsplash.com/photo-1563636619-e9143da7973b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400&q=80'],
                        category: 'dairy',
                        stock: 20,
                        specifications: {
                            origin: 'Uttar Pradesh, India',
                            shelf_life: '3 days',
                            storage: 'Refrigerate'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Gopal Yadav',
                            farm: 'Happy Cow Dairy',
                            location: 'Uttar Pradesh, India'
                        }
                    },
                    {
                        _id: '6',
                        name: 'Farm Eggs',
                        description: 'Free-range organic eggs from happy, healthy chickens.',
                        price: 120,
                        unit: 'dozen',
                        images: ['https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400&q=80'],
                        category: 'poultry',
                        stock: 0, // Out of stock
                        specifications: {
                            origin: 'Local Farm',
                            shelf_life: '3 weeks',
                            storage: 'Refrigerate'
                        },
                        is_active: true,
                        farmer: {
                            name: 'Local Poultry Farm',
                            farm: 'Happy Hens Farm',
                            location: 'Local'
                        }
                    }
                ];
            }

            getDemoTours() {
                return [
                    {
                        _id: 'tour1',
                        name: 'Organic Vegetable Farm Tour',
                        description: 'Join us for a guided tour of our organic farm and learn about sustainable farming practices.',
                        price: 499,
                        images: ['https://images.unsplash.com/photo-1520052203542-d3095f1b6cf0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '2 hours',
                        capacity: '15 people',
                        category: 'farm_tour',
                        includes: ['Guided farm tour', 'Vegetable picking', 'Organic lunch', 'Take-home produce'],
                        farmer: {
                            name: 'Rajesh Kumar',
                            farm: 'Green Valley Organic Farm'
                        },
                        is_active: true
                    },
                    {
                        _id: 'tour2',
                        name: 'Dairy Farm Experience',
                        description: 'Experience a day in the life of a dairy farmer with milking sessions and butter making.',
                        price: 699,
                        images: ['https://images.unsplash.com/photo-1570042225831-d98fa7577f1e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '3 hours',
                        capacity: '10 people',
                        category: 'experience',
                        includes: ['Milking session', 'Butter making', 'Farm fresh dairy products'],
                        farmer: {
                            name: 'Gopal Yadav',
                            farm: 'Happy Cow Dairy'
                        },
                        is_active: true
                    },
                    {
                        _id: 'tour3',
                        name: 'Vineyard & Wine Tasting',
                        description: 'Tour through beautiful vineyards and learn about wine production with tasting sessions.',
                        price: 899,
                        images: ['https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '4 hours',
                        capacity: '12 people',
                        category: 'experience',
                        includes: ['Vineyard tour', 'Wine tasting', 'Cheese pairing'],
                        farmer: {
                            name: 'Vineyard Estates',
                            farm: 'Sunrise Vineyards'
                        },
                        is_active: true
                    },
                    {
                        _id: 'tour4',
                        name: 'Seasonal Fruit Picking',
                        description: 'Pick your own seasonal fruits straight from the orchard and learn about fruit cultivation.',
                        price: 399,
                        images: ['https://images.unsplash.com/photo-1598300042247-d088f8ab3a91?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=200&q=80'],
                        duration: '2 hours',
                        capacity: '20 people',
                        category: 'farm_tour',
                        includes: ['Orchard tour', 'Fruit picking', 'Take-home fruits'],
                        farmer: {
                            name: 'Local Orchard',
                            farm: 'Sunny Fruit Farms'
                        },
                        is_active: true
                    }
                ];
            }

            isUsingDemoData() {
                return this.useDemoData;
            }
        }

        // Initialize API service
        const customerAPI = new CustomerAPIService();

        // Global variables
        let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
        let allProducts = [];
        let allTours = [];
        let currentSearchState = {
            isSearching: false,
            searchTerm: '',
            searchResults: {
                products: [],
                tours: []
            }
        };

        // DOM Elements
        const cartIcon = document.getElementById('cartIcon');
        const cartModal = document.getElementById('cartModal');
        const overlay = document.getElementById('overlay');
        const closeCart = document.getElementById('closeCart');
        const cartItemsContainer = document.getElementById('cartItems');
        const emptyCart = document.getElementById('emptyCart');
        const cartCount = document.getElementById('cartCount');
        const cartTotal = document.getElementById('cartTotal');
        const totalAmount = document.getElementById('totalAmount');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const bottomCartBtn = document.getElementById('bottomCartBtn');
        const bottomCartCount = document.getElementById('bottomCartCount');
        const offlineIndicator = document.getElementById('offlineIndicator');
        
        // Cart functionality
        if (cartIcon) {
            cartIcon.addEventListener('click', openCart);
        }
        bottomCartBtn.addEventListener('click', openCart);
        
        function openCart() {
            cartModal.classList.add('open');
            overlay.classList.add('open');
            document.body.style.overflow = 'hidden';
        }
        
        // Close cart
        closeCart.addEventListener('click', closeCartModal);
        overlay.addEventListener('click', closeCartModal);
        
        function closeCartModal() {
            cartModal.classList.remove('open');
            overlay.classList.remove('open');
            document.body.style.overflow = 'auto';
        }
        
        // Update cart UI
        function updateCartUI() {
            // Update cart count
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            bottomCartCount.textContent = totalItems;
            
            // Update cart items
            cartItemsContainer.innerHTML = '';
            
            if (cartItems.length === 0) {
                emptyCart.style.display = 'block';
                cartTotal.style.display = 'none';
                checkoutBtn.style.display = 'none';
            } else {
                emptyCart.style.display = 'none';
                cartTotal.style.display = 'flex';
                checkoutBtn.style.display = 'block';
                
                let total = 0;
                
                cartItems.forEach(item => {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    
                    cartItem.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="cart-item-img">
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">₹${item.price}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="decreaseQuantity('${item.id}')">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn" onclick="increaseQuantity('${item.id}')">+</button>
                            </div>
                        </div>
                        <button class="remove-item" onclick="removeFromCart('${item.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    cartItemsContainer.appendChild(cartItem);
                    total += item.price * item.quantity;
                });
                
                totalAmount.textContent = `₹${total}`;
            }
            
            // Save to localStorage
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
        }
        
        // Add to cart
        function addToCart(item) {
            const existingItem = cartItems.find(cartItem => cartItem.id === item.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cartItems.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    image: item.image,
                    quantity: 1
                });
            }
            
            updateCartUI();
            
            // Show confirmation
            showNotification(`${item.name} added to cart!`);
        }
        
        // Remove from cart
        function removeFromCart(id) {
            cartItems = cartItems.filter(item => item.id !== id);
            updateCartUI();
        }
        
        // Increase quantity
        function increaseQuantity(id) {
            const item = cartItems.find(item => item.id === id);
            if (item) {
                item.quantity += 1;
                updateCartUI();
            }
        }
        
        // Decrease quantity
        function decreaseQuantity(id) {
            const item = cartItems.find(item => item.id === id);
            if (item) {
                if (item.quantity > 1) {
                    item.quantity -= 1;
                } else {
                    removeFromCart(id);
                }
                updateCartUI();
            }
        }
        
        // Handle checkout
        function handleCheckout() {
            if (customerAPI.isUsingDemoData()) {
                showNotification('Checkout is disabled in demo mode. Please connect to the server for real purchases.', 5000);
                return false;
            }
            
            // In a real app, this would redirect to payment page
            showNotification('Redirecting to payment...');
            return true;
        }
        
        // Show notification
        function showNotification(message, duration = 3000) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: var(--primary);
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                z-index: 1000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 300px;
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }
        
        // Render products
        function renderProducts(products) {
            const container = document.getElementById('productsContainer');
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-seedling"></i>
                        <h3>No products found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = products.map(product => {
                const isOutOfStock = product.stock === 0;
                const isLowStock = product.stock > 0 && product.stock < 10;
                
                return `
                    <div class="card ${isOutOfStock ? 'out-of-stock' : ''}" data-id="${product._id}">
                        <div class="card-img">
                            <img src="${product.images[0]}" alt="${product.name}" 
                                 onerror="this.src='https://via.placeholder.com/300x200?text=Product+Image'">
                        </div>
                        <div class="card-content">
                            <h3>${product.name}</h3>
                            <p>${product.description.substring(0, 100)}...</p>
                            <div class="card-price">₹${product.price} / ${product.unit}</div>
                            ${isLowStock ? `<div class="stock-low">Only ${product.stock} left in stock</div>` : ''}
                            <div class="card-actions">
                                <button class="btn btn-primary" onclick="addToCart({
                                    id: '${product._id}',
                                    name: '${product.name}',
                                    price: ${product.price},
                                    image: '${product.images[0]}'
                                })" ${isOutOfStock ? 'disabled' : ''}>
                                    <i class="fas fa-cart-plus"></i> ${isOutOfStock ? 'Out of Stock' : 'Add to Cart'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Render tours
        function renderTours(tours) {
            const container = document.getElementById('toursContainer');
            
            if (!tours || tours.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-tractor"></i>
                        <h3>No tours found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = tours.map(tour => `
                <div class="card" data-id="${tour._id}">
                    <div class="card-img">
                        <img src="${tour.images[0]}" alt="${tour.name}"
                             onerror="this.src='https://via.placeholder.com/300x200?text=Tour+Image'">
                    </div>
                    <div class="card-content">
                        <h3>${tour.name}</h3>
                        <p>${tour.description.substring(0, 100)}...</p>
                        <div class="card-price">₹${tour.price} / person</div>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 0.8rem;">
                            <i class="fas fa-clock"></i> ${tour.duration} • 
                            <i class="fas fa-users"></i> ${tour.capacity}
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="addToCart({
                                id: '${tour._id}',
                                name: '${tour.name}',
                                price: ${tour.price},
                                image: '${tour.images[0]}'
                            })">
                                <i class="fas fa-calendar-check"></i> Book Now
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Search products and tours
        function searchProducts() {
            const searchTerm = document.getElementById('globalSearch').value.trim().toLowerCase();
            
            if (!searchTerm) {
                // If search is empty, show all products and tours
                currentSearchState.isSearching = false;
                renderProducts(allProducts);
                renderTours(allTours);
                return;
            }
            
            currentSearchState.isSearching = true;
            currentSearchState.searchTerm = searchTerm;
            
            // Filter products and tours
            const filteredProducts = allProducts.filter(product => 
                product.name.toLowerCase().includes(searchTerm) || 
                product.description.toLowerCase().includes(searchTerm) ||
                (product.category && product.category.toLowerCase().includes(searchTerm)) ||
                (product.farmer && product.farmer.name.toLowerCase().includes(searchTerm)) ||
                (product.farmer && product.farmer.farm.toLowerCase().includes(searchTerm))
            );
            
            const filteredTours = allTours.filter(tour => 
                tour.name.toLowerCase().includes(searchTerm) || 
                tour.description.toLowerCase().includes(searchTerm) ||
                (tour.category && tour.category.toLowerCase().includes(searchTerm)) ||
                (tour.farmer && tour.farmer.name.toLowerCase().includes(searchTerm)) ||
                (tour.farmer && tour.farmer.farm.toLowerCase().includes(searchTerm))
            );
            
            currentSearchState.searchResults.products = filteredProducts;
            currentSearchState.searchResults.tours = filteredTours;
            
            // Render filtered results
            renderProducts(filteredProducts);
            renderTours(filteredTours);
            
            // Show search notification
            if (filteredProducts.length === 0 && filteredTours.length === 0) {
                showNotification(`No results found for "${searchTerm}"`);
            } else {
                showNotification(`Found ${filteredProducts.length + filteredTours.length} results for "${searchTerm}"`);
            }
        }
        
        // Initialize the app
        async function initApp() {
            try {
                // Show offline indicator initially
                if (offlineIndicator) {
                    offlineIndicator.style.display = 'block';
                }
                
                // Load products and tours
                allProducts = await customerAPI.getProducts();
                allTours = await customerAPI.getTours();
                
                // Update offline indicator based on data source
                if (offlineIndicator) {
                    if (customerAPI.isUsingDemoData()) {
                        offlineIndicator.innerHTML = '<i class="fas fa-wifi-slash"></i> Using demo data. Some features may be limited.';
                        offlineIndicator.style.background = '#ff9800';
                    } else {
                        offlineIndicator.innerHTML = '<i class="fas fa-wifi"></i> Connected to server';
                        offlineIndicator.style.background = '#4CAF50';
                        
                        // Hide after 3 seconds if connected
                        setTimeout(() => {
                            offlineIndicator.style.display = 'none';
                        }, 3000);
                    }
                }
                
                // Render initial data
                renderProducts(allProducts);
                renderTours(allTours);
                
                // Update cart UI
                updateCartUI();
                
                // Add search functionality to input field
                const searchInput = document.getElementById('globalSearch');
                searchInput.addEventListener('keyup', function(event) {
                    if (event.key === 'Enter') {
                        searchProducts();
                    }
                });
                
                console.log('App initialized successfully');
                
            } catch (error) {
                console.error('Error initializing app:', error);
                
                // Show error state but with demo data
                showNotification('Using demo data. Some features may be limited.', 5000);
                
                if (offlineIndicator) {
                    offlineIndicator.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Connection failed. Using demo data.';
                    offlineIndicator.style.background = '#f44336';
                }
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>